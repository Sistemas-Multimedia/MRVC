<!DOCTYPE html> 
<html lang='en-US' xml:lang='en-US'> 
<head> <title>Multi-Resolution Video Coding (MRVC)</title> 
<meta charset='utf-8' /> 
<meta content='TeX4ht (https://tug.org/tex4ht/)' name='generator' /> 
<meta content='width=device-width,initial-scale=1' name='viewport' /> 
<link href='index.css' rel='stylesheet' type='text/css' /> 
<meta content='index.tex' name='src' /> 
<script>window.MathJax = { tex: { tags: "ams", }, }; </script> 
 <script async='async' id='MathJax-script' src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js' type='text/javascript'></script>  
</head><body>
   <div class='maketitle'>
                                                                  

                                                                  
                                                                  

                                                                  

<h2 class='titleHead'><a href='https://github.com/Sistemas-Multimedia/PRMC'>Multi-Resolution Video Coding (MRVC)</a></h2>
 <div class='author'><span class='ecrm-1200'>Vicente González Ruiz</span></div><br />
<div class='date'><span class='ecrm-1200'>December 28, 2024</span></div>
   </div>
   <h3 class='likesectionHead'><a id='x1-1000'></a>Contents</h3>
   <div class='tableofcontents'>
    <span class='sectionToc'>1 <a href='#x1-30001' id='QQ2-1-3'>Transform coding and compression</a></span>
<br />    <span class='sectionToc'>2 <a href='#x1-40002' id='QQ2-1-4'>The 2D-DWT (Distrete Wavelet Transform)</a></span>
<br />     <span class='subsectionToc'>2.1 <a href='#x1-50002.1' id='QQ2-1-5'>Implementation of the 3 components (usually color) DWT step</a></span>
<br />    <span class='sectionToc'>3 <a href='#x1-60003' id='QQ2-1-9'>Multi-level DWT structures</a></span>
<br />    <span class='sectionToc'>4 <a href='#x1-70004' id='QQ2-1-11'>Scalability provided by the DWT</a></span>
<br />     <span class='subsectionToc'>4.1 <a href='#x1-80004.1' id='QQ2-1-12'>Example: A 1-iteration DWT</a></span>
<br />     <span class='subsectionToc'>4.2 <a href='#x1-90004.2' id='QQ2-1-13'>Example: A 2-iterations DWT (\(2\times \mathtt@@ {DWT}\))</a></span>
<br />    <span class='sectionToc'>5 <a href='#x1-100005' id='QQ2-1-14'>Motion DWT (MDWT)</a></span>
<br />    <span class='sectionToc'>6 <a href='#x1-110006' id='QQ2-1-19'>Scalability provided by MDWT</a></span>
<br />     <span class='subsectionToc'>6.1 <a href='#x1-120006.1' id='QQ2-1-20'>Example: 1-iteration MDWT (\(\mathtt@@ {MDWT}(N=5)\))</a></span>
<br />     <span class='subsectionToc'>6.2 <a href='#x1-130006.2' id='QQ2-1-21'>Example: 2-iterations MDWT (\(2\times \mathtt@@ {MDWT}(N=5)\))</a></span>
<br />     <span class='subsectionToc'>6.3 <a href='#x1-140006.3' id='QQ2-1-22'>Example: Interpolating (a sequence) with the DWT</a></span>
<br />    <span class='sectionToc'>7 <a href='#x1-150007' id='QQ2-1-23'>Video transform alternatives</a></span>
<br />    <span class='sectionToc'>8 <a href='#x1-160008' id='QQ2-1-24'>DWT structures and Laplacian Pyramids</a></span>
<br />    <span class='sectionToc'>9 <a href='#x1-170009' id='QQ2-1-25'>Motion Compensated Orthogonal Laplacian Pyramid (MCOLP)</a></span>
<br />     <span class='subsectionToc'>9.1 <a href='#x1-180009.1' id='QQ2-1-26'>The MCOLP butterfly</a></span>
<br />     <span class='subsectionToc'>9.2 <a href='#x1-190009.2' id='QQ2-1-32'>The MCOLP transform</a></span>
<br />     <span class='subsectionToc'>9.3 <a href='#x1-200009.3' id='QQ2-1-36'>Example: \(\mathtt@@ {MRVC}(T=1, N=5)\)</a></span>
<br />     <span class='subsectionToc'>9.4 <a href='#x1-210009.4' id='QQ2-1-38'>Example: \(\mathtt@@ {MRVC}(T=2, N=5)\)</a></span>
<br />     <span class='subsectionToc'>9.5 <a href='#x1-220009.5' id='QQ2-1-40'>Simplification of the notation</a></span>
<br />     <span class='subsectionToc'>9.6 <a href='#x1-230009.6' id='QQ2-1-41'>Example: \(\mathtt@@ {MRVC}(T=4, N=17)\)</a></span>
<br />     <span class='subsectionToc'>9.7 <a href='#x1-240009.7' id='QQ2-1-43'>Scalability provided by MCOLP</a></span>
<br />     <span class='subsectionToc'>9.8 <a href='#x1-250009.8' id='QQ2-1-44'>Example: 3-iters of \(\mathtt@@ {MRVC}(T=2, N=5)\)</a></span>
<br />    <span class='sectionToc'>10 <a href='#x1-2600010' id='QQ2-1-47'>Adaptive motion compensation based on the energy of the estimated prediction error</a></span>
<br />    <span class='sectionToc'>11 <a href='#x1-2700011' id='QQ2-1-51'>Lossy compression: quantization</a></span>
<br />     <span class='subsectionToc'>11.1 <a href='#x1-2800011.1' id='QQ2-1-52'>Example: Effects caused by the total attenuation of the motion
compensated (MCed) \(H\) subbands</a></span>
                                                                  

                                                                  
<br />     <span class='subsectionToc'>11.2 <a href='#x1-2900011.2' id='QQ2-1-53'>Example: Effects caused by the quantization of MCed \(H\) subbands</a></span>
<br />     <span class='subsectionToc'>11.3 <a href='#x1-3000011.3' id='QQ2-1-54'>Example: Quantization of all \(H\) subbands (MCed and intra)</a></span>
<br />     <span class='subsectionToc'>11.4 <a href='#x1-3100011.4' id='QQ2-1-55'>Example: Quantization of all subbands</a></span>
   </div>
<!-- l. 21 --><p class='noindent'>
</p>
   <h3 class='likesectionHead'><a id='x1-2000'></a>Abstract</h3>
<!-- l. 24 --><p class='noindent'>MRVCs is a transform that inputs a video (a sequence of frames of pixels) and
outputs a decomposition (a sequence of spatio-temporal subbands of coefficients). It
consists of two stages:
</p><!-- l. 28 --><p class='indent'>
     </p><ol class='enumerate1'>
<li class='enumerate' id='x1-2002x1'>MDWT (Motion Discrete Wavelet Transform), that computes the 1-levels
     2D-DWT to every video frame, resulting a representation with \(2\) SRLs
     (Spatial Resolution Levels).
     </li>
<li class='enumerate' id='x1-2004x2'>MCOLP (Motion Compensated in the Orthogonal Laplacian Pyramid),
     which estimates the motion in the lower SRL and compensates the motion
     in the high-frequencies of the higher SRL, using a Orthogonal Lapacial
     Pyramid  structure  that  has  a  critical  representation  in  the  2D-DWT
     domain.</li></ol>
<!-- l. 39 --><p class='indent'>   MRVC can be applied recursively to the lower SLR, producing a multiresolution
representation of the video and compensating the motion of the sequence. The output
decomposition concentrates most of the energy in a small number of subbands
(usually, those representing the low frquencies) which enables the lossy compression
of the video.
</p><!-- l. 47 --><p class='noindent'>
</p>
   <h3 class='sectionHead'><span class='titlemark'>1   </span> <a id='x1-30001'></a>Transform coding and compression</h3>
<!-- l. 50 --><p class='noindent'><a href='https://en.wikipedia.org/wiki/Video'>Video</a> data contain high amounts of <a href='https://vicente-gonzalez-ruiz.github.io/redundancy/'>redundancy</a>, spatial and temporal.
For this reason, most of <a href='https://vicente-gonzalez-ruiz.github.io/video_compression/'>video encoders</a> compress an input sequence of
<a href='https://en.wikipedia.org/wiki/Digital_image'>images</a><span class='footnote-mark'><a href='#fn1x0' id='fn1x0-bk'><sup class='textsuperscript'>1</sup></a></span><a id='x1-3001f1'></a>,
basically, in two stages: (1) a transform in the <a href='https://en.wikipedia.org/wiki/Time_domain'>time</a> and in the <a href='https://www.quora.com/What-is-spatial-domain-in-image-processing'>spatial</a> domains that
                                                                  

                                                                  
produces a collection of <a href='https://en.wikipedia.org/wiki/Decorrelation'>uncorrelated</a> <a href='https://en.wikipedia.org/wiki/Discrete_wavelet_transform'>subbands</a>, and (2) an <a href='https://en.wikipedia.org/wiki/Entropy_encoding'>entropy encoding</a> stage
which removes the statistical redundancy that can still remains after the
decorrelation (transform). Usually, these coefficients have two interesting
features:
     </p><ol class='enumerate1'>
<li class='enumerate' id='x1-3004x1'>Usually,  a   <a href='https://vicente-gonzalez-ruiz.github.io/symbol_compression/'><span class='ecbx-1000'>smaller  entropy</span></a> than  the  original  pixels.  This  helps  to
     increase the <a href='https://en.wikipedia.org/wiki/Data_compression_ratio'>compression ratio</a>.
     </li>
<li class='enumerate' id='x1-3006x2'>A <a href='https://en.wikipedia.org/wiki/Image_resolution'><span class='ecbx-1000'>multiresolution representation</span></a> <span class='ecbx-1000'>(in space and time) </span>of the visual
     information.  This  provides  the  posibility  of  decoding  the  sequence  of
     images using a smaller resolution. This feature is known as <a href='https://vicente-gonzalez-ruiz.github.io/video_compression/'>spatio-temporal
     scalability in video</a>.
     </li>
<li class='enumerate' id='x1-3008x3'>Usually, <span class='ecbx-1000'>most of the </span><a href='https://en.wikipedia.org/wiki/Energy_(signal_processing)'><span class='ecbx-1000'>signal energy</span></a> (and therefore, generally, most of
     the information interesting for the humans) <span class='ecbx-1000'>is represented by </span><a href='https://vicente-gonzalez-ruiz.github.io/image_transformations_for_coding'><span class='ecbx-1000'>a small
     </span><span class='ecbx-1000'>number of subbands</span></a>. This helps to improve the compression ratio and
     to prioritize the data in <a href='https://vicente-gonzalez-ruiz.github.io/media_encoding_models/'>progressive transmission scenarios</a>.</li></ol>
<!-- l. 92 --><p class='noindent'>
</p>
   <h3 class='sectionHead'><span class='titlemark'>2   </span> <a id='x1-40002'></a>The 2D-DWT (Distrete Wavelet Transform)</h3>
<!-- l. 97 --><p class='noindent'><a href='https://vicente-gonzalez-ruiz.github.io/image_transformations_for_coding/#x1-3100020'>The 2D-DWT (2-Dimensions Distrete Wavelet
Transform)<span class='footnote-mark'><a href='#fn2x0' id='fn2x0-bk'><sup class='textsuperscript'>2</sup></a></span><a id='x1-4001f2'></a></a>
is a digital transform that, applied to an image, performs a accumulation of the
energy of the image in a small number of <a href='https://en.wikipedia.org/wiki/Sub-band_coding'>subbands</a> and obtains a <a href='https://vicente-gonzalez-ruiz.github.io/image_transformations_for_coding/index.html#x1-3500024'>multiresolution
(generally dyadic) representation</a> of such image. The subbands conform a
decomposition<span class='footnote-mark'><a href='#fn3x0' id='fn3x0-bk'><sup class='textsuperscript'>3</sup></a></span><a id='x1-4003f3'></a>
\(\{LL, LH, HL, HH\}\), were \(L\) stands for 1D low-pass <a href='https://en.wikipedia.org/wiki/Filter_bank'>analysis</a> <a href='https://en.wikipedia.org/wiki/Filter_(signal_processing)'>filtering</a> and \(H\) for 1D high-pass analysis
filtering. Thus, for example, \(LH\) is the result of applying the \(L\) filter to the rows and
downsample<span class='footnote-mark'><a href='#fn4x0' id='fn4x0-bk'><sup class='textsuperscript'>4</sup></a></span><a id='x1-4005f4'></a>
the output by a factor of 2, and then applying the \(H\) filter to the columns of the
previous decomposition and again, donwsampling by a factor of 2. The subbands are
populated by coefficients representing different spatial areas, depending on
the localization of the coefficient and the resolution level. Notice that it is
                                                                  

                                                                  
possible to compute the (2D-)DWT using 1D filters. Therefore, the DWT is
<a href='http://home.ustc.edu.cn/~xuedixiu/image.ustc/course/dip/DIP14-ch3.pdf'>separable</a>.
</p><!-- l. 121 --><p class='indent'>   The downsampling operation generates a critically sampled structure,
where the number of output DWT coefficients is equal to the number of
input pixels. This is possible because ideally, the \(L\) filter is designed to reject
the frecuencies that the \(H\) filter pass, and viceversa (it is said that the
filters are complementary, or that they form a <a href='https://en.wikipedia.org/wiki/Filter_bank#Perfect_reconstruction_filter_banks'>perfect-reconstruction filter
bank</a>). In the practice, there is always some aliasing (overlaping between
the response of the filters in the frequency domain), but this does not
affect<span class='footnote-mark'><a href='#fn5x0' id='fn5x0-bk'><sup class='textsuperscript'>5</sup></a></span><a id='x1-4007f5'></a>
to the number of output coefficients. In terms of <a href='https://en.wikipedia.org/wiki/Linear_algebra'>Linear Algebra</a>, analysis \(L\)
and \(H\) filters, and the synthesis \(L^{-1}\) and \(H^{-1}\) filters (the filters that reconstruct the
pixels from the coefficients generated by \(L\) and \(H\)) would be <a href='https://en.wikipedia.org/wiki/Orthogonality'>orthogonal</a>, that
is, the basis functions that they convolve with the signals are completely
indenpendent.
</p><!-- l. 142 --><p class='indent'>   For the sake of simplicity, we will denote the 1-iteration DWT spatial
decomposition as \(\{L, H\}\) where \(L=LL\) and \(H=\{LH, HL, HH\}\). See also <a href='https://nbviewer.jupyter.org/github/Sistemas-Multimedia/MRVC/blob/master/docs/DWT_vs_LPT.ipynb'>DWT vs LPT</a>.
</p><!-- l. 150 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>2.1   </span> <a id='x1-50002.1'></a>Implementation of the 3 components (usually color) DWT step</h4>
<!-- l. 153 --><p class='noindent'><a href='https://github.com/Sistemas-Multimedia/MRVC/blob/master/src/DWT.py'>DWT.py</a> (see Fig. <a href='#x1-5103r1'>1<!-- tex4ht:ref: fig:DWT  --></a>) implements the forward (DWT) and backward (iDWT)
1-iteration (step) DWT for color images.
</p>
   <figure class='figure'> 

                                                                  

                                                                  
                                                                  

                                                                  
<!-- l. 159 --><pre class='lstinputlisting' id='listing-1'><span class='label'><a id='x1-5003r1'></a></span><span style='color:#000000'><span class='ecit-1000'> </span></span><span style='color:#000000'><span class='ecit-1000'>import</span></span><span style='color:#000000'> <span class='ecit-1000'>distortion</span> 
</span><span class='label'><a id='x1-5004r2'></a></span><span style='color:#000000'><span class='ectt-1000'>import</span></span><span style='color:#000000'> <span class='ectt-1000'>image_3</span> 
</span><span class='label'><a id='x1-5005r3'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>import</span></span><span style='color:#000000'> <span class='ecit-1000'>L_DWT </span><span class='ecit-1000'>as </span><span class='ecit-1000'>L</span> 
</span><span class='label'><a id='x1-5006r4'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>import</span></span><span style='color:#000000'> <span class='ecit-1000'>H_DWT </span><span class='ecit-1000'>as </span><span class='ecit-1000'>H</span> 
</span><span class='label'><a id='x1-5007r5'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>import</span></span><span style='color:#000000'> <span class='ecit-1000'>debug</span> 
</span><span class='label'><a id='x1-5008r6'></a></span><span style='color:#000000'><span class='ectt-1000'>import</span></span><span style='color:#000000'> <span class='ectt-1000'>information</span> 
</span><span class='label'><a id='x1-5009r7'></a></span> 
<span class='label'><a id='x1-5010r8'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>import</span></span><span style='color:#000000'> <span class='ecit-1000'>logging</span> 
</span><span class='label'><a id='x1-5011r9'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>logging</span></span><span style='color:#000000'><span class='ecit-1000'>.</span></span><span style='color:#000000'><span class='ecit-1000'>basicConfig</span></span><span style='color:#000000'><span class='ecit-1000'>(</span></span> 
<span class='label'><a id='x1-5012r10'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'> </span><span class='ecit-1000'>   </span><span style='color:#000000'><span class='ecit-1000'>level</span></span><span style='color:#000000'><span class='ecit-1000'>=</span></span><span style='color:#000000'><span class='ecit-1000'>logging</span></span><span style='color:#000000'><span class='ecit-1000'>.</span></span><span style='color:#000000'><span class='ecit-1000'>INFO</span></span><span style='color:#000000'><span class='ecit-1000'>,</span></span> 
<span class='label'><a id='x1-5013r11'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'> </span><span class='ecit-1000'>   </span><span style='color:#000000'><span class='ecit-1000'>format</span></span><span style='color:#000000'><span class='ecit-1000'>="%(</span></span><span style='color:#000000'><span class='ecit-1000'>pathname</span></span><span style='color:#000000'><span class='ecit-1000'>)</span></span><span style='color:#000000'><span class='ecit-1000'>s</span></span><span style='color:#000000'><span class='ecit-1000'>:%(</span></span><span style='color:#000000'><span class='ecit-1000'>lineno</span></span><span style='color:#000000'><span class='ecit-1000'>)</span></span><span style='color:#000000'><span class='ecit-1000'>d</span></span><span style='color:#000000'> <span class='ecit-1000'>%(levelname)s </span><span class='ecit-1000'>%(message)s",</span> 
</span><span class='label'><a id='x1-5014r12'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'> </span><span class='ecit-1000'>   </span><span style='color:#000000'><span class='ecit-1000'>format</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>"[%(filename)s:%(lineno)s </span><span class='ecit-1000'>- </span><span class='ecit-1000'>%(funcName)20s() </span><span class='ecit-1000'>] </span><span class='ecit-1000'>%(message)s"</span> 
</span><span class='label'><a id='x1-5015r13'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'> </span><span class='ecit-1000'>   </span><span style='color:#000000'><span class='ecit-1000'>handlers</span></span><span style='color:#000000'><span class='ecit-1000'>=[</span></span> 
<span class='label'><a id='x1-5016r14'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'> </span><span class='ecit-1000'>       </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>logging</span></span><span style='color:#000000'><span class='ecit-1000'>.</span></span><span style='color:#000000'><span class='ecit-1000'>FileHandler</span></span><span style='color:#000000'><span class='ecit-1000'>("</span></span><span style='color:#000000'><span class='ecit-1000'>debug</span></span><span style='color:#000000'><span class='ecit-1000'>.</span></span><span style='color:#000000'><span class='ecit-1000'>log</span></span><span style='color:#000000'><span class='ecit-1000'>"),</span></span> 
<span class='label'><a id='x1-5017r15'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'> </span><span class='ecit-1000'>       </span><span style='color:#000000'><span class='ecit-1000'>logging</span></span><span style='color:#000000'><span class='ecit-1000'>.</span></span><span style='color:#000000'><span class='ecit-1000'>StreamHandler</span></span><span style='color:#000000'><span class='ecit-1000'>()</span></span> 
<span class='label'><a id='x1-5018r16'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'> </span><span class='ecit-1000'>   </span><span style='color:#000000'><span class='ecit-1000'>]</span></span> 
<span class='label'><a id='x1-5019r17'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>)</span></span> 
<span class='label'><a id='x1-5020r18'></a></span> 
<span class='label'><a id='x1-5021r19'></a></span><span style='color:#000000'><span class='ectt-1000'>import</span></span><span style='color:#000000'> <span class='ectt-1000'>logging</span> 
</span><span class='label'><a id='x1-5022r20'></a></span><span style='color:#000000'><span class='ectt-1000'>logger</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>logging.getLogger(__name__)</span> 
</span><span class='label'><a id='x1-5023r21'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>logging</span></span><span style='color:#000000'><span class='ecit-1000'>.</span></span><span style='color:#000000'><span class='ecit-1000'>basicConfig</span></span><span style='color:#000000'><span class='ecit-1000'>(</span></span><span style='color:#000000'><span class='ecit-1000'>format</span></span><span style='color:#000000'><span class='ecit-1000'>="[%(</span></span><span style='color:#000000'><span class='ecit-1000'>filename</span></span><span style='color:#000000'><span class='ecit-1000'>)</span></span><span style='color:#000000'><span class='ecit-1000'>s</span></span><span style='color:#000000'><span class='ecit-1000'>:%(</span></span><span style='color:#000000'><span class='ecit-1000'>lineno</span></span><span style='color:#000000'><span class='ecit-1000'>)</span></span><span style='color:#000000'><span class='ecit-1000'>s</span></span><span style='color:#000000'> <span class='ecit-1000'>%(funcName)s()] </span><span class='ecit-1000'>%(message)s")</span> 
</span><span class='label'><a id='x1-5024r22'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>logger</span></span><span style='color:#000000'><span class='ecit-1000'>.</span></span><span style='color:#000000'><span class='ecit-1000'>setLevel</span></span><span style='color:#000000'><span class='ecit-1000'>(</span></span><span style='color:#000000'><span class='ecit-1000'>logging</span></span><span style='color:#000000'><span class='ecit-1000'>.</span></span><span style='color:#000000'><span class='ecit-1000'>CRITICAL</span></span><span style='color:#000000'><span class='ecit-1000'>)</span></span> 
<span class='label'><a id='x1-5025r23'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>logger</span></span><span style='color:#000000'><span class='ecit-1000'>.</span></span><span style='color:#000000'><span class='ecit-1000'>setLevel</span></span><span style='color:#000000'><span class='ecit-1000'>(</span></span><span style='color:#000000'><span class='ecit-1000'>logging</span></span><span style='color:#000000'><span class='ecit-1000'>.</span></span><span style='color:#000000'><span class='ecit-1000'>ERROR</span></span><span style='color:#000000'><span class='ecit-1000'>)</span></span> 
<span class='label'><a id='x1-5026r24'></a></span><span style='color:#000000'><span class='ectt-1000'>logger</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>setLevel</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>logging</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>WARNING</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span> 
<span class='label'><a id='x1-5027r25'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>logger</span></span><span style='color:#000000'><span class='ecit-1000'>.</span></span><span style='color:#000000'><span class='ecit-1000'>setLevel</span></span><span style='color:#000000'><span class='ecit-1000'>(</span></span><span style='color:#000000'><span class='ecit-1000'>logging</span></span><span style='color:#000000'><span class='ecit-1000'>.</span></span><span style='color:#000000'><span class='ecit-1000'>INFO</span></span><span style='color:#000000'><span class='ecit-1000'>)</span></span> 
<span class='label'><a id='x1-5028r26'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>logger</span></span><span style='color:#000000'><span class='ecit-1000'>.</span></span><span style='color:#000000'><span class='ecit-1000'>setLevel</span></span><span style='color:#000000'><span class='ecit-1000'>(</span></span><span style='color:#000000'><span class='ecit-1000'>logging</span></span><span style='color:#000000'><span class='ecit-1000'>.</span></span><span style='color:#000000'><span class='ecit-1000'>DEBUG</span></span><span style='color:#000000'><span class='ecit-1000'>)</span></span> 
<span class='label'><a id='x1-5029r27'></a></span> 
<span class='label'><a id='x1-5030r28'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>_wavelet</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>pywt.Wavelet("haar")</span> 
</span><span class='label'><a id='x1-5031r29'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>_wavelet</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>pywt.Wavelet("db1")</span> 
</span><span class='label'><a id='x1-5032r30'></a></span><span style='color:#000000'><span class='ectt-1000'>_wavelet</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>pywt.Wavelet("db5")</span> 
</span><span class='label'><a id='x1-5033r31'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>_wavelet</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>pywt.Wavelet("db20")</span> 
</span><span class='label'><a id='x1-5034r32'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>_wavelet</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>pywt.Wavelet("bior3.5")</span> 
</span><span class='label'><a id='x1-5035r33'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>_wavelet</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>pywt.Wavelet("bior3.7")</span> 
</span><span class='label'><a id='x1-5036r34'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>_wavelet</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>pywt.Wavelet("bior6.8")</span> 
</span><span class='label'><a id='x1-5037r35'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>_wavelet</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>pywt.Wavelet("rbio6.8")</span> 
</span><span class='label'><a id='x1-5038r36'></a></span> 
<span class='label'><a id='x1-5039r37'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'> <span class='ecit-1000'>Number </span><span class='ecit-1000'>of </span><span class='ecit-1000'>levels </span><span class='ecit-1000'>of </span><span class='ecit-1000'>the </span><span class='ecit-1000'>DWT</span> 
</span><span class='label'><a id='x1-5040r38'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>N_levels</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>config.n_levels</span> 
</span><span class='label'><a id='x1-5041r39'></a></span><span style='color:#000000'><span class='ectt-1000'>_N_levels</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>5</span> 
</span><span class='label'><a id='x1-5042r40'></a></span> 
<span class='label'><a id='x1-5043r41'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'> <span class='ecit-1000'>Signal </span><span class='ecit-1000'>extension </span><span class='ecit-1000'>mode</span> 
</span><span class='label'><a id='x1-5044r42'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>_extension_mode</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>"symmetric" </span><span class='ecit-1000'># </span><span class='ecit-1000'>default</span> 
</span><span class='label'><a id='x1-5045r43'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>_extension_mode</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>"constant"</span> 
</span><span class='label'><a id='x1-5046r44'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>_extension_mode</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>"reflect"</span> 
</span><span class='label'><a id='x1-5047r45'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>_extension_mode</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>"periodic"</span> 
</span><span class='label'><a id='x1-5048r46'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>_extension_mode</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>"smooth"</span> 
</span><span class='label'><a id='x1-5049r47'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>_extension_mode</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>"antisymmetric"</span> 
</span><span class='label'><a id='x1-5050r48'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>_extension_mode</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>"antireflect"</span> 
</span><span class='label'><a id='x1-5051r49'></a></span><span style='color:#000000'><span class='ectt-1000'>_extension_mode</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>"periodization" </span><span class='ecit-1000'># </span><span class='ecit-1000'>Generates </span><span class='ecit-1000'>the </span><span class='ecit-1000'>inimal </span><span class='ecit-1000'>number </span><span class='ecit-1000'>of </span><span class='ecit-1000'>coeffs</span> 
</span><span class='label'><a id='x1-5052r50'></a></span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>_extension_mode</span></span><span style='color:#000000'> <span class='ecit-1000'>= </span><span class='ecit-1000'>config.dwt_extension_mode</span> 
</span><span class='label'><a id='x1-5053r51'></a></span> 
<span class='label'><a id='x1-5054r52'></a></span><span style='color:#000000'><span class='ectt-1000'>logger</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>info</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>f</span></span><span style='color:#000000'><span class='ectt-1000'>"</span></span><span style='color:#000000'><span class='ectt-1000'>Wavelet</span></span><span style='color:#000000'><span class='ectt-1000'>={</span></span><span style='color:#000000'><span class='ectt-1000'>_wavelet</span></span><span style='color:#000000'><span class='ectt-1000'>}</span></span><span style='color:#000000'><span class='ectt-1000'>"</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span> 
<span class='label'><a id='x1-5055r53'></a></span><span style='color:#000000'><span class='ectt-1000'>logger</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>info</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>f</span></span><span style='color:#000000'><span class='ectt-1000'>"</span></span><span style='color:#000000'><span class='ectt-1000'>DWT</span></span><span style='color:#000000'> <span class='ectt-1000'>extension </span><span class='ectt-1000'>mode={_extension_mode}")</span> 
</span><span class='label'><a id='x1-5056r54'></a></span> 
<span class='label'><a id='x1-5057r55'></a></span><span style='color:#000000'><span class='ectt-1000'>def</span></span><span style='color:#000000'> <span class='ectt-1000'>analyze_step(color_image, </span><span class='ectt-1000'>wavelet=_wavelet):</span> 
</span><span class='label'><a id='x1-5058r56'></a></span><span class='ecit-1000'>    </span><span style='color:#000000'><span class='tcit-1000'>'''</span></span><span style='color:#000000'><span class='ecit-1000'>Color</span></span><span style='color:#000000'> <span class='ecit-1000'>1-levels </span><span class='ecit-1000'>forward </span><span class='ecit-1000'>2D-DWT.</span> 
</span><span class='label'><a id='x1-5059r57'></a></span> 
<span class='label'><a id='x1-5060r58'></a></span><span class='ecit-1000'>    </span><span style='color:#000000'><span class='ecit-1000'>Parameters</span></span> 
<span class='label'><a id='x1-5061r59'></a></span><span class='ecit-1000'>    </span><span style='color:#000000'><span class='ecit-1000'>----------</span></span> 
<span class='label'><a id='x1-5062r60'></a></span><span class='ecit-1000'>    </span><span style='color:#000000'><span class='ecit-1000'>color_image</span></span><span style='color:#000000'> <span class='ecit-1000'>: </span><span class='ecit-1000'>[row, </span><span class='ecit-1000'>column, </span><span class='ecit-1000'>component] </span><span class='ecit-1000'>np.ndarray</span> 
</span><span class='label'><a id='x1-5063r61'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Color</span></span><span style='color:#000000'> <span class='ecit-1000'>image </span><span class='ecit-1000'>to </span><span class='ecit-1000'>be </span><span class='ecit-1000'>analyzed.</span> 
</span><span class='label'><a id='x1-5064r62'></a></span><span class='ecit-1000'>    </span><span style='color:#000000'><span class='ecit-1000'>wavelet</span></span><span style='color:#000000'> <span class='ecit-1000'>: </span><span class='ecit-1000'>pywt.Wavelet</span> 
</span><span class='label'><a id='x1-5065r63'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Wavelet</span></span><span style='color:#000000'> <span class='ecit-1000'>name.</span> 
</span><span class='label'><a id='x1-5066r64'></a></span> 
<span class='label'><a id='x1-5067r65'></a></span><span class='ecit-1000'>    </span><span style='color:#000000'><span class='ecit-1000'>Returns</span></span> 
<span class='label'><a id='x1-5068r66'></a></span><span class='ecit-1000'>    </span><span style='color:#000000'><span class='ecit-1000'>-------</span></span> 
<span class='label'><a id='x1-5069r67'></a></span><span class='ecit-1000'>    </span><span style='color:#000000'><span class='ecit-1000'>A</span></span><span style='color:#000000'> <span class='ecit-1000'>1-levels </span><span class='ecit-1000'>color </span><span class='ecit-1000'>decomposition </span><span class='ecit-1000'>: </span><span class='ecit-1000'>tuple</span> 
</span><span class='label'><a id='x1-5070r68'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Subbands</span></span><span style='color:#000000'> <span class='ecit-1000'>(LL, </span><span class='ecit-1000'>(LH, </span><span class='ecit-1000'>HL, </span><span class='ecit-1000'>HH)).</span> 
</span><span class='label'><a id='x1-5071r69'></a></span> 
<span class='label'><a id='x1-5072r70'></a></span><span class='ecit-1000'>    </span><span style='color:#000000'><span class='tcit-1000'>'''</span></span> 
<span class='label'><a id='x1-5073r71'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>logger</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>info</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>f</span></span><span style='color:#000000'><span class='ectt-1000'>"</span></span><span style='color:#000000'><span class='ectt-1000'>wavelet</span></span><span style='color:#000000'><span class='ectt-1000'>={</span></span><span style='color:#000000'><span class='ectt-1000'>wavelet</span></span><span style='color:#000000'><span class='ectt-1000'>}</span></span><span style='color:#000000'><span class='ectt-1000'>"</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span> 
<span class='label'><a id='x1-5074r72'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>N_comps</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>color_image.shape[2]</span> 
</span><span class='label'><a id='x1-5075r73'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>decomposition_by_component</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>[None]*N_comps</span> 
</span><span class='label'><a id='x1-5076r74'></a></span><span class='ecit-1000'>    </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'> <span class='ecit-1000'>A </span><span class='ecit-1000'>color </span><span class='ecit-1000'>decomposition</span> 
</span><span class='label'><a id='x1-5077r75'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>for</span></span><span style='color:#000000'> <span class='ectt-1000'>c </span><span class='ectt-1000'>in </span><span class='ectt-1000'>range(N_comps):</span> 
</span><span class='label'><a id='x1-5078r76'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>decomposition_by_component</span></span><span style='color:#000000'><span class='ectt-1000'>[</span></span><span style='color:#000000'><span class='ectt-1000'>c</span></span><span style='color:#000000'><span class='ectt-1000'>]</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>pywt.dwt2(data=color_image[:,:,c], </span><span class='ectt-1000'>wavelet=wavelet, </span><span class='ectt-1000'>mode=_extension_mode)</span> 
</span><span class='label'><a id='x1-5079r77'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>assert</span></span><span style='color:#000000'> <span class='ectt-1000'>decomposition_by_component[0][0].shape </span><span class='ectt-1000'>== </span><span class='ectt-1000'>decomposition_by_component[0][1][0].shape</span> 
</span><span class='label'><a id='x1-5080r78'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>N_rows_subband</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'> <span class='ectt-1000'>N_columns_subband </span><span class='ectt-1000'>= </span><span class='ectt-1000'>decomposition_by_component[0][0].shape </span><span class='ecit-1000'># </span><span class='ecit-1000'>All </span><span class='ecit-1000'>subbands </span><span class='ecit-1000'>have </span><span class='ecit-1000'>the </span><span class='ecit-1000'>same </span><span class='ecit-1000'>shape</span> 
</span><span class='label'><a id='x1-5081r79'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>LL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>np.empty(shape=(N_rows_subband, </span><span class='ectt-1000'>N_columns_subband, </span><span class='ectt-1000'>N_comps), </span><span class='ectt-1000'>dtype=np.float64)</span> 
</span><span class='label'><a id='x1-5082r80'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>LH</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>np.empty(shape=(N_rows_subband, </span><span class='ectt-1000'>N_columns_subband, </span><span class='ectt-1000'>N_comps), </span><span class='ectt-1000'>dtype=np.float64)</span> 
</span><span class='label'><a id='x1-5083r81'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>HL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>np.empty(shape=(N_rows_subband, </span><span class='ectt-1000'>N_columns_subband, </span><span class='ectt-1000'>N_comps), </span><span class='ectt-1000'>dtype=np.float64)</span> 
</span><span class='label'><a id='x1-5084r82'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>HH</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>np.empty(shape=(N_rows_subband, </span><span class='ectt-1000'>N_columns_subband, </span><span class='ectt-1000'>N_comps), </span><span class='ectt-1000'>dtype=np.float64)</span> 
</span><span class='label'><a id='x1-5085r83'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>for</span></span><span style='color:#000000'> <span class='ectt-1000'>c </span><span class='ectt-1000'>in </span><span class='ectt-1000'>range(N_comps):</span> 
</span><span class='label'><a id='x1-5086r84'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>LL</span></span><span style='color:#000000'><span class='ectt-1000'>[:,:,</span></span><span style='color:#000000'><span class='ectt-1000'>c</span></span><span style='color:#000000'><span class='ectt-1000'>]</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>decomposition_by_component[c][0][:,:]</span> 
</span><span class='label'><a id='x1-5087r85'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>LH</span></span><span style='color:#000000'><span class='ectt-1000'>[:,:,</span></span><span style='color:#000000'><span class='ectt-1000'>c</span></span><span style='color:#000000'><span class='ectt-1000'>]</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>decomposition_by_component[c][1][0][:,:]</span> 
</span><span class='label'><a id='x1-5088r86'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>HL</span></span><span style='color:#000000'><span class='ectt-1000'>[:,:,</span></span><span style='color:#000000'><span class='ectt-1000'>c</span></span><span style='color:#000000'><span class='ectt-1000'>]</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>decomposition_by_component[c][1][1][:,:]</span> 
</span><span class='label'><a id='x1-5089r87'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>HH</span></span><span style='color:#000000'><span class='ectt-1000'>[:,:,</span></span><span style='color:#000000'><span class='ectt-1000'>c</span></span><span style='color:#000000'><span class='ectt-1000'>]</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>decomposition_by_component[c][1][2][:,:]</span> 
</span><span class='label'><a id='x1-5090r88'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>return</span></span><span style='color:#000000'> <span class='ectt-1000'>(LL, </span><span class='ectt-1000'>(LH, </span><span class='ectt-1000'>HL, </span><span class='ectt-1000'>HH)) </span><span class='ecit-1000'># </span><span class='ecit-1000'>Ojo, </span><span class='ecit-1000'>para </span><span class='ecit-1000'>ser </span><span class='ecit-1000'>coherentes, </span><span class='ecit-1000'>deberia</span> 
</span><span class='label'><a id='x1-5091r89'></a></span><span class='ecit-1000'>                              </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'> <span class='ecit-1000'>retornarse </span><span class='ecit-1000'>una </span><span class='ecit-1000'>lista, </span><span class='ecit-1000'>no </span><span class='ecit-1000'>una </span><span class='ecit-1000'>tupla, </span><span class='ecit-1000'>y</span> 
</span><span class='label'><a id='x1-5092r90'></a></span><span class='ecit-1000'>                              </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'> <span class='ecit-1000'>asi </span><span class='ecit-1000'>tendriamos </span><span class='ecit-1000'>una </span><span class='ecit-1000'>descomposicion </span><span class='ecit-1000'>de </span><span class='ecit-1000'>1</span> 
</span><span class='label'><a id='x1-5093r91'></a></span><span class='ecit-1000'>                              </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'> <span class='ecit-1000'>nivel</span> 
</span><span class='label'><a id='x1-5094r92'></a></span> 
<span class='label'><a id='x1-5095r93'></a></span><span style='color:#000000'><span class='ectt-1000'>def</span></span><span style='color:#000000'> <span class='ectt-1000'>synthesize_step(LL, </span><span class='ectt-1000'>H, </span><span class='ectt-1000'>wavelet=_wavelet):</span> 
</span><span class='label'><a id='x1-5096r94'></a></span><span class='ecit-1000'>    </span><span style='color:#000000'><span class='tcit-1000'>'''</span></span><span style='color:#000000'><span class='ecit-1000'>Color</span></span><span style='color:#000000'> <span class='ecit-1000'>1-levels </span><span class='ecit-1000'>backward </span><span class='ecit-1000'>2D-DWT.</span> 
</span><span class='label'><a id='x1-5097r95'></a></span> 
<span class='label'><a id='x1-5098r96'></a></span><span class='ecit-1000'>    </span><span style='color:#000000'><span class='ecit-1000'>Parameters</span></span> 
<span class='label'><a id='x1-5099r97'></a></span><span class='ecit-1000'>    </span><span style='color:#000000'><span class='ecit-1000'>----------</span></span> 
<span class='label'><a id='x1-5100r98'></a></span><span class='ecit-1000'>    </span><span style='color:#000000'><span class='ecit-1000'>LL</span></span><span style='color:#000000'> <span class='ecit-1000'>: </span><span class='ecit-1000'>np.ndarray</span> 
</span><span class='label'><a id='x1-5101r99'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Low</span></span><span style='color:#000000'><span class='ecit-1000'>-</span></span><span style='color:#000000'><span class='ecit-1000'>pass</span></span><span style='color:#000000'> <span class='ecit-1000'>subband.</span> 
</span><span class='label'><a id='x1-5102r100'></a></span><span class='ecit-1000'>    </span><span style='color:#000000'><span class='ecit-1000'>H</span></span><span style='color:#000000'> <span class='ecit-1000'>: </span><span class='ecit-1000'>tuple</span></span>
</pre>
<a id='x1-5103r1'></a>
<figcaption class='caption'><span class='id'>Figure 1: </span><span class='content'>Implementation of the multicomponent 1-iteration DWT (forward
and backward). More information about the implementation can be found at
<a href='https://pywavelets.readthedocs.io/en/latest/index.html'>PyWavelets</a>.
</span></figcaption><!-- tex4ht:label?: x1-5103r1  -->
                                                                  

                                                                  
   </figure>
   <h3 class='sectionHead'><span class='titlemark'>3   </span> <a id='x1-60003'></a>Multi-level DWT structures</h3>
<!-- l. 172 --><p class='noindent'>A \(N\)-iterations<span class='footnote-mark'><a href='#fn6x0' id='fn6x0-bk'><sup class='textsuperscript'>6</sup></a></span><a id='x1-6001f6'></a>
dyadic DWT is the result of a recursive use of the 1-iteration DWT applied to the \(L\)
subband, \(N\) times, producing a \((N+1)\)-levels dyadic structure which is able to provide \(N+1\) Spatial
Resolution Levels (SRL’s). For example, in the Fig. <a href='#x1-6003r2'>2<!-- tex4ht:ref: fig:2-levels_DWT  --></a> the DWT has been applied
2-times, generating 3 SRLs: (1) \(L^2\), (2) \(L^1=\mathtt {iDWT}(L^2, H^2)\), and (3) \(L^0=\mathtt {iDWT}(L^1, H^1)\), where \(\mathtt {iDWT}\) stands for inverse
DWT.
</p>
   <figure class='figure'> 

                                                                  

                                                                  
                                                                  

                                                                  
<pre class='verbatim' id='verbatim-1'>
    +------+------+-------------+ 0         +------+------+-------------+
    |      |      |             |           |      |      |             |
    | LL^2 | LH^2 |             |           | L^2  |      |             |
    |      |      |             |           |      |      |             |
    +------+------+     LH^1    |           +------+      |             |
    |      |      |             |           |             |             |
    | HL^2 | HH^2 |             |           |        H^2  |             |
    |      |      |             | Y/2-1     |             |             |
    +------+------+-------------+       =   +-------------+             |
    |             |             |           |                           |
    |             |             |           |                           |
    |             |             |           |                           |
    |     HL^1    |     HH^1    |           |                    H^1    |
    |             |             |           |                           |
    |             |             |           |                           |
    |             |             | Y-1       |                           |
    +-------------+-------------+           +---------------------------+
    0           X/2-1         X-1
</pre>
<!-- l. 204 --><p class='nopar'> <a id='x1-6003r2'></a>
</p>
<figcaption class='caption'><span class='id'>Figure 2: </span><span class='content'>Decomposition generated by \(\mathtt {DWT}(\mathtt {iters}=2)\) using the standard notation (left) and
the compact notation (right).
</span></figcaption><!-- tex4ht:label?: x1-6003r2  -->
                                                                  

                                                                  
   </figure>
   <h3 class='sectionHead'><span class='titlemark'>4   </span> <a id='x1-70004'></a>Scalability provided by the DWT</h3>
<!-- l. 214 --><p class='noindent'>Depending on the number of subband levels (pyramid levels in the <a href='https://vicente-gonzalez-ruiz.github.io/pyramids-and-wavelets/'>OLP</a>), we can
reconstruct an image at different spatial scales (resolutions). For example, if a image
has been transformed using the DWT of \(2\) iterations (see Fig. <a href='#x1-6003r2'>2<!-- tex4ht:ref: fig:2-levels_DWT  --></a>), we get:
</p>
     <ul class='itemize1'>
     <li class='itemize'>
     <!-- l. 220 --><p class='noindent'>Subband \(L^2\) with the scale \(2\) of the image. If such image is \(I\), we will denote the
     scale \(2\) as \(I.L^2\).
                                                                  

                                                                  
</p>
     <pre class='verbatim' id='verbatim-2'>
         +------+
         |      |
     Y/4 |  L^2 |
         |      |
         +------+
            X/4
</pre>
     <!-- l. 229 --><p class='nopar'>
     </p></li>
     <li class='itemize'>
     <!-- l. 230 --><p class='noindent'>Subband \(L^1\coloneqq L=\mathtt {iDWT}(L^2, H^2)\) with \(I.L^1\).
                                                                  

                                                                  
</p>
     <pre class='verbatim' id='verbatim-3'>
         +-------------+
         |             |
         |             |
     Y/2 |     L^1     |
         |             |
         |             |
         +-------------+
               X/2
</pre>
     <!-- l. 241 --><p class='nopar'>
     </p></li>
     <li class='itemize'>
     <!-- l. 243 --><p class='noindent'>\(L^0=\mathtt {iDWT}(L, H)\) (the original image) with the scale \(I.L^0=I\).
                                                                  

                                                                  
</p>
     <pre class='verbatim' id='verbatim-4'>
         +---------------------------+
         |                           |
         |                           |
         |                           |
         |                           |
         |                           |
         |                           |
       Y |            L^0            |
         |                           |
         |                           |
         |                           |
         |                           |
         |                           |
         |                           |
         +---------------------------+
                       X
</pre>
     <!-- l. 262 --><p class='nopar'></p></li></ul>
<!-- l. 269 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>4.1   </span> <a id='x1-80004.1'></a>Example: A 1-iteration DWT</h4>
<!-- l. 272 --><p class='noindent'>An image is transformed, generating four subbands \(LL\), \(LH\), \(HL\) and \(HH\).
                                                                  

                                                                  
</p>
   <pre class='verbatim' id='verbatim-5'>
# You must be in the ’src’ directory.

# Copy an image (the output directory must be the same as the input one).
rm /tmp/*.png
cp ../sequences/stockholm/000.png /tmp

# 1-iteration 2D DWT.
python3 -O DWT.py -p /tmp/ -i 000

# Visualize the subbands.
display -normalize /tmp/LL000.png # &lt;- LL^1
display -normalize /tmp/LH000.png # &lt;- LH^1
display -normalize /tmp/HL000.png # &lt;- HL^1
display -normalize /tmp/HH000.png # &lt;- HH^1

# 1-iteration 2D iDWT.
python3 -O DWT.py -b -p /tmp/ -i 000

# Visualize the reconstruction.
python3 ../tools/substract_offset.py -i /tmp/000.png -o /tmp/1.png
display /tmp/1.png

# Show diferences (PyWavelets uses floating point arithmetic).
../tools/show_differences.sh -1 /tmp/000.png -2 ../sequences/stockholm/000.png -o /tmp/diffs.png
display /tmp/diffs.png
</pre>
<!-- l. 300 --><p class='nopar'>
</p><!-- l. 304 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>4.2   </span> <a id='x1-90004.2'></a>Example: A 2-iterations DWT (\(2\times \mathtt {DWT}\))</h4>
                                                                  

                                                                  
   <pre class='verbatim' id='verbatim-6'>
# You must be in the ’src’ directory.

# Copy a image (the output directory must be the same than the input one).
rm /tmp/*.png
cp ../sequences/stockholm/000.png /tmp

# First iteration.
python3 -O DWT.py -p /tmp/ -i 000

# Second iteration.
python3 -O DWT.py -p /tmp/LL -i 000

# Visualize the subbands.
ls -l /tmp/*.png
display -normalize /tmp/LL000.png # &lt;- LL^1
display -normalize /tmp/LH000.png # &lt;- LH^1
display -normalize /tmp/HL000.png # &lt;- HL^1
display -normalize /tmp/HH000.png # &lt;- HH^1
display -normalize /tmp/LLLL000.png # &lt;- LL^2
display -normalize /tmp/LLLH000.png # &lt;- LH^2
display -normalize /tmp/LLHL000.png # &lt;- HL^2
display -normalize /tmp/LLHH000.png # &lt;- HH^2

# Reverse second iteration.
python3 -O DWT.py -b -p /tmp/LL -i 000
display -normalize /tmp/LL000.png

# Reverse first iteration.
python3 -O DWT.py -b -p /tmp/ -i 000
python3 ../tools/substract_offset.py -i /tmp/000.png -o /tmp/1.png
display /tmp/1.png

# Show diferences.
../tools/show_differences.sh -1 /tmp/000.png -2 ../sequences/stockholm/000.png -o /tmp/diffs.png
display /tmp/diffs.png
</pre>
<!-- l. 343 --><p class='nopar'>
</p><!-- l. 349 --><p class='noindent'>
</p>
   <h3 class='sectionHead'><span class='titlemark'>5   </span> <a id='x1-100005'></a>Motion DWT (MDWT)</h3>
                                                                  

                                                                  
<!-- l. 352 --><p class='noindent'>The 2D-DWT can be applied to a sequence of frames (images) by simply
transforming each one independently. This is done, for example, in the <a href='https://vicente-gonzalez-ruiz.github.io/JPEG2000/'>Motion
JPEG2000 video compression standard</a>. Notice that only the spatial redundancy
is exploited in MDWT (all the temporal redundancy still remains in the
video). The decomposition structure generated by MDWT is shown in the
Fig <a href='#x1-10001r3'>3<!-- tex4ht:ref: fig:MDWT-subbands  --></a>. The 1-iteration MDWT inputs a sequence of frames \(\{F_i\}\) and outputs a
sequence of decompositions \(\{\{F_i\}.L, \{F_i\}.H\}\), also called sequence spatial subbands. In all this
discussion, \(i\) is an integer number starting a \(0\) (\(F_0\) is always the first frame of the
video). Notice that \(\{F_i\}.L\) represents the scale \(1\) of the sequence (a version of the
original video \(\{F_i\}\) but with a resolution \(Y/2\times X/2\)), and that \(\{F_i\}.L^0 = \{F_i\} = \mathtt {iMDWT}(\{F_i\}.L,\{F_i\}.H )\). See the Fig. <a href='#x1-10055r4'>4<!-- tex4ht:ref: fig:MDWT-implementation  --></a> for more
details.
</p>
   <figure class='figure'> 

                                                                  

                                                                  
                                                                  

                                                                  
<!-- l. 369 --><p class='noindent'><div style='text-align:center;'> <img src='graphics/forward_MDWT.svg' /> </div>  <a id='x1-10001r3'></a>
</p>
<figcaption class='caption'><span class='id'>Figure 3: </span><span class='content'>Subbands produced by the MDWT.                           </span></figcaption><!-- tex4ht:label?: x1-10001r3  -->
                                                                  

                                                                  
   </figure>
   <figure class='figure'> 

                                                                  

                                                                  
                                                                  

                                                                  
<!-- l. 377 --><pre class='lstinputlisting' id='listing-2'><span class='label'><a id='x1-10004r1'></a></span><span style='color:#000000'><span class='ectt-1000'> lass</span></span><span style='color:#000000'> <span class='ectt-1000'>MDWT:</span> 
</span><span class='label'><a id='x1-10005r2'></a></span> 
<span class='label'><a id='x1-10006r3'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>def</span></span><span style='color:#000000'> <span class='ectt-1000'>__init__(self, </span><span class='ectt-1000'>wavelet </span><span class='ectt-1000'>= </span><span class='ectt-1000'>"bior3.5"):</span> 
</span><span class='label'><a id='x1-10007r4'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>self</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>dwt</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>DWT(wavelet)</span> 
</span><span class='label'><a id='x1-10008r5'></a></span> 
<span class='label'><a id='x1-10009r6'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>def</span></span><span style='color:#000000'> <span class='ectt-1000'>forward(self, </span><span class='ectt-1000'>prefix="/tmp/", </span><span class='ectt-1000'>N=5):</span> 
</span><span class='label'><a id='x1-10010r7'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='tcit-1000'>'''</span></span><span style='color:#000000'><span class='ecit-1000'>1-</span></span><span style='color:#000000'><span class='ecit-1000'>iteration</span></span><span style='color:#000000'> <span class='ecit-1000'>Motion </span><span class='ecit-1000'>2D </span><span class='ecit-1000'>DWT </span><span class='ecit-1000'>of </span><span class='ecit-1000'>a </span><span class='ecit-1000'>sequence </span><span class='ecit-1000'>of </span><span class='ecit-1000'>images.</span> 
</span><span class='label'><a id='x1-10011r8'></a></span> 
<span class='label'><a id='x1-10012r9'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Compute</span></span><span style='color:#000000'> <span class='ecit-1000'>the </span><span class='ecit-1000'>forward </span><span class='ecit-1000'>2D-DWT </span><span class='ecit-1000'>of </span><span class='ecit-1000'>each </span><span class='ecit-1000'>image </span><span class='ecit-1000'>of </span><span class='ecit-1000'>the </span><span class='ecit-1000'>sequence</span> 
</span><span class='label'><a id='x1-10013r10'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>placed</span></span><span style='color:#000000'> <span class='ecit-1000'>at </span><span class='ecit-1000'>&lt;prefix&gt;.</span> 
</span><span class='label'><a id='x1-10014r11'></a></span> 
<span class='label'><a id='x1-10015r12'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Input</span></span> 
<span class='label'><a id='x1-10016r13'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>-----</span></span> 
<span class='label'><a id='x1-10017r14'></a></span> 
<span class='label'><a id='x1-10018r15'></a></span><span class='ecit-1000'>            </span><span style='color:#000000'><span class='ecit-1000'>prefix</span></span><span style='color:#000000'><span class='ecit-1000'>:</span></span><span style='color:#000000'> <span class='ecit-1000'>the </span><span class='ecit-1000'>sequence </span><span class='ecit-1000'>of </span><span class='ecit-1000'>images </span><span class='ecit-1000'>to </span><span class='ecit-1000'>be </span><span class='ecit-1000'>transformed.</span> 
</span><span class='label'><a id='x1-10019r16'></a></span><span class='ecit-1000'>            </span><span style='color:#000000'><span class='ecit-1000'>N</span></span><span style='color:#000000'><span class='ecit-1000'>:</span></span><span style='color:#000000'> <span class='ecit-1000'>number </span><span class='ecit-1000'>of </span><span class='ecit-1000'>images.</span> 
</span><span class='label'><a id='x1-10020r17'></a></span> 
<span class='label'><a id='x1-10021r18'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Output</span></span> 
<span class='label'><a id='x1-10022r19'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>------</span></span> 
<span class='label'><a id='x1-10023r20'></a></span> 
<span class='label'><a id='x1-10024r21'></a></span><span class='ecit-1000'>            </span><span style='color:#000000'><span class='ecit-1000'>(</span></span><span style='color:#000000'><span class='ecit-1000'>disk</span></span><span style='color:#000000'><span class='ecit-1000'>):</span></span><span style='color:#000000'> <span class='ecit-1000'>the </span><span class='ecit-1000'>sequence </span><span class='ecit-1000'>of </span><span class='ecit-1000'>decompositions.</span> 
</span><span class='label'><a id='x1-10025r22'></a></span> 
<span class='label'><a id='x1-10026r23'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='tcit-1000'>'''</span></span> 
<span class='label'><a id='x1-10027r24'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>for</span></span><span style='color:#000000'> <span class='ectt-1000'>i </span><span class='ectt-1000'>in </span><span class='ectt-1000'>range(N):</span> 
</span><span class='label'><a id='x1-10028r25'></a></span><span class='ectt-1000'>            </span><span style='color:#000000'><span class='ectt-1000'>img</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>image.read(prefix, </span><span class='ectt-1000'>"{:03d}".format(i))</span> 
</span><span class='label'><a id='x1-10029r26'></a></span><span class='ectt-1000'>            </span><span style='color:#000000'><span class='ectt-1000'>pyr</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.dwt.forward(img)</span> 
</span><span class='label'><a id='x1-10030r27'></a></span><span class='ectt-1000'>            </span><span style='color:#000000'><span class='ectt-1000'>decomposition</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>write</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>pyr</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'> <span class='ectt-1000'>prefix, </span><span class='ectt-1000'>"{:03d}".format(i))</span> 
</span><span class='label'><a id='x1-10031r28'></a></span> 
<span class='label'><a id='x1-10032r29'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>def</span></span><span style='color:#000000'> <span class='ectt-1000'>backward(self, </span><span class='ectt-1000'>prefix="/tmp/", </span><span class='ectt-1000'>N=5):</span> 
</span><span class='label'><a id='x1-10033r30'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='tcit-1000'>'''</span></span><span style='color:#000000'><span class='ecit-1000'>1-</span></span><span style='color:#000000'><span class='ecit-1000'>iteration</span></span><span style='color:#000000'> <span class='ecit-1000'>Inverse </span><span class='ecit-1000'>Motion </span><span class='ecit-1000'>2D </span><span class='ecit-1000'>DWT </span><span class='ecit-1000'>of </span><span class='ecit-1000'>a </span><span class='ecit-1000'>sequence </span><span class='ecit-1000'>of </span><span class='ecit-1000'>decompositions.</span> 
</span><span class='label'><a id='x1-10034r31'></a></span> 
<span class='label'><a id='x1-10035r32'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Compute</span></span><span style='color:#000000'> <span class='ecit-1000'>the </span><span class='ecit-1000'>inverse </span><span class='ecit-1000'>2D-DWT </span><span class='ecit-1000'>of </span><span class='ecit-1000'>each </span><span class='ecit-1000'>decomposition </span><span class='ecit-1000'>of </span><span class='ecit-1000'>the</span> 
</span><span class='label'><a id='x1-10036r33'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>sequence</span></span><span style='color:#000000'> <span class='ecit-1000'>of </span><span class='ecit-1000'>decompositions </span><span class='ecit-1000'>placed </span><span class='ecit-1000'>at </span><span class='ecit-1000'>&lt;prefix&gt;.</span> 
</span><span class='label'><a id='x1-10037r34'></a></span> 
<span class='label'><a id='x1-10038r35'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Input</span></span><span style='color:#000000'><span class='ecit-1000'>:</span></span> 
<span class='label'><a id='x1-10039r36'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>-----</span></span> 
<span class='label'><a id='x1-10040r37'></a></span> 
<span class='label'><a id='x1-10041r38'></a></span><span class='ecit-1000'>            </span><span style='color:#000000'><span class='ecit-1000'>prefix</span></span><span style='color:#000000'><span class='ecit-1000'>:</span></span><span style='color:#000000'> <span class='ecit-1000'>the </span><span class='ecit-1000'>sequence </span><span class='ecit-1000'>of </span><span class='ecit-1000'>decompositions </span><span class='ecit-1000'>to </span><span class='ecit-1000'>be </span><span class='ecit-1000'>transformed.</span> 
</span><span class='label'><a id='x1-10042r39'></a></span><span class='ecit-1000'>            </span><span style='color:#000000'><span class='ecit-1000'>N</span></span><span style='color:#000000'><span class='ecit-1000'>:</span></span><span style='color:#000000'> <span class='ecit-1000'>the </span><span class='ecit-1000'>number </span><span class='ecit-1000'>of </span><span class='ecit-1000'>decompositions.</span> 
</span><span class='label'><a id='x1-10043r40'></a></span> 
<span class='label'><a id='x1-10044r41'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Output</span></span><span style='color:#000000'><span class='ecit-1000'>:</span></span> 
<span class='label'><a id='x1-10045r42'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>------</span></span> 
<span class='label'><a id='x1-10046r43'></a></span> 
<span class='label'><a id='x1-10047r44'></a></span><span class='ecit-1000'>            </span><span style='color:#000000'><span class='ecit-1000'>(</span></span><span style='color:#000000'><span class='ecit-1000'>disk</span></span><span style='color:#000000'><span class='ecit-1000'>):</span></span><span style='color:#000000'> <span class='ecit-1000'>the </span><span class='ecit-1000'>sequence </span><span class='ecit-1000'>of </span><span class='ecit-1000'>images.</span> 
</span><span class='label'><a id='x1-10048r45'></a></span> 
<span class='label'><a id='x1-10049r46'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='tcit-1000'>'''</span></span> 
<span class='label'><a id='x1-10050r47'></a></span> 
<span class='label'><a id='x1-10051r48'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>for</span></span><span style='color:#000000'> <span class='ectt-1000'>i </span><span class='ectt-1000'>in </span><span class='ectt-1000'>range(N):</span> 
</span><span class='label'><a id='x1-10052r49'></a></span><span class='ectt-1000'>            </span><span style='color:#000000'><span class='ectt-1000'>pyr</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>decomposition.read(prefix, </span><span class='ectt-1000'>"{:03d}".format(i))</span> 
</span><span class='label'><a id='x1-10053r50'></a></span><span class='ectt-1000'>            </span><span style='color:#000000'><span class='ectt-1000'>img</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.dwt.backward(pyr)</span> 
</span><span class='label'><a id='x1-10054r51'></a></span><span class='ectt-1000'>            </span><span style='color:#000000'><span class='ectt-1000'>image</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>write</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>img</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'> <span class='ectt-1000'>prefix, </span><span class='ectt-1000'>"{:03d}".format(i))</span></span>
</pre>
<!-- l. 377 --><p class='noindent'>. <a id='x1-10055r4'></a>
</p>
<figcaption class='caption'><span class='id'>Figure 4: </span><span class='content'>Implementation of the MDWT.
</span></figcaption><!-- tex4ht:label?: x1-10055r4  -->
                                                                  

                                                                  
   </figure>
   <h3 class='sectionHead'><span class='titlemark'>6   </span> <a id='x1-110006'></a>Scalability provided by MDWT</h3>
<!-- l. 387 --><p class='noindent'>MDWT sequences (of (subband) decompositions) are scalable in space and in time.
Spatial scalability is a direct consequence of the DWT (the number of SRLs can be
controlled by the number of iterations of DWT). On the other hand, it is trivial to
observe that MDWT provides <span class='ecti-1000'>fully </span>temporal scalability (we can access to the
images randomly) because each image of the input sequence is transformed
independently.
</p><!-- l. 399 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>6.1   </span> <a id='x1-120006.1'></a>Example: 1-iteration MDWT (\(\mathtt {MDWT}(N=5)\))</h4>
                                                                  

                                                                  
   <pre class='verbatim' id='verbatim-7'>
# You must be in the ’src’ directory.
rm /tmp/*.png

# Create the output directory for the 1st-level decompositions.
yes | cp ../sequences/stockholm/*.png /tmp

# 2D 1-iteration MDWT.
python3 -O MDWT.py -p /tmp/ -N 5

# Visualize the subbands.
for i in /tmp/LL00?.png; do convert -normalize $i $i.norm; done
animate /tmp/LL*.norm
for i in /tmp/LH00?.png; do convert -normalize $i $i.norm; done
animate /tmp/LH*.norm
for i in /tmp/HL00?.png; do convert -normalize $i $i.norm; done
animate /tmp/HL*.norm
for i in /tmp/HH00?.png; do convert -normalize $i $i.norm; done
animate /tmp/HH*.norm

# 1-iteration iMDWT.
python3 -O MDWT.py -b -p /tmp/ -N 5

# Visualization of the reconstruction.
for i in /tmp/???.png; do python3 ../tools/substract_offset.py -i $i -o $i.png; done
animate /tmp/???.png.png

# Visualization of the residue.
for i in {0..4}; do ii=$(printf "%03d" $i); bash ../tools/show_differences.sh -1 /tmp/$ii.png -2 ../sequences/stockholm/$ii.png -o /tmp/diff_$ii.png; done
animate /tmp/diff*.png
</pre>
<!-- l. 432 --><p class='nopar'>
</p><!-- l. 436 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>6.2   </span> <a id='x1-130006.2'></a>Example: 2-iterations MDWT (\(2\times \mathtt {MDWT}(N=5)\))</h4>
                                                                  

                                                                  
   <pre class='verbatim' id='verbatim-8'>
# You must be in the ’src’ directory.
rm /tmp/*.png

# Create the output directory for the 1st-level decompositions.
yes | cp ../sequences/stockholm/*.png /tmp

# 2-iterations MDWT.
python3 -O MDWT.py -p /tmp/ -N 5
python3 -O MDWT.py -p /tmp/LL -N 5

# 2-iterations iMDWT.
python3 -O MDWT.py -b -p /tmp/LL -N 5
python3 -O MDWT.py -b -p /tmp/ -N 5

# Visualization of the reconstruction.
for i in /tmp/???.png; do python3 ../tools/substract_offset.py -i $i -o $i.png; done
animate /tmp/???.png.png

# Visualization of the residue.
for i in {0..4}; do ii=$(printf "%03d" $i); bash ../tools/show_differences.sh -1 /tmp/$ii.png -2 ../sequences/stockholm/$ii.png -o /tmp/diff_$ii.png; done
animate /tmp/diff*.png
</pre>
<!-- l. 461 --><p class='nopar'>
</p><!-- l. 465 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>6.3   </span> <a id='x1-140006.3'></a>Example: Interpolating (a sequence) with the DWT</h4>
<!-- l. 468 --><p class='noindent'>If we apply an inverse transform to the original
frames<span class='footnote-mark'><a href='#fn7x0' id='fn7x0-bk'><sup class='textsuperscript'>7</sup></a></span><a id='x1-14001f7'></a>,
supposing that they are the low-frequency subbands of the input decomposition, and
that the high-frequency subbands are zero, we can interpolate each frame of the
original sequence by a factor of \(2\) in each direction.
                                                                  

                                                                  
</p>
   <pre class='verbatim' id='verbatim-9'>
# You must be in the ’src’ directory.
rm /tmp/*.png

# Copy the current images as LL subbands.
rm /tmp/*.png
for i in {0..4}; do
  image_number=$(printf "%03d" $i)
  cp ../sequences/stockholm/$image_number.png /tmp/LL$image_number.png
done

# Apply the inverse DWT.
python3 -O MDWT.py -b -p /tmp/ -N 5

# Visualization of the reconstruction.
for i in /tmp/???.png; do python3 ../tools/substract_offset.py -i $i -o $i.png; done
animate /tmp/???.png.png

# Notice that the dynamic range of the sequence could be changed (the
# images could appear brighter of darker). This is consequence of the
# relative gain of the LL subband in respect of the rest of subbands.
rm /tmp/*.norm
for i in /tmp/???.png; do convert -normalize $i $i.norm; done
animate /tmp/*.png.norm
</pre>
<!-- l. 498 --><p class='nopar'>
</p><!-- l. 504 --><p class='noindent'>
</p>
   <h3 class='sectionHead'><span class='titlemark'>7   </span> <a id='x1-150007'></a>Video transform alternatives</h3>
<!-- l. 507 --><p class='noindent'>To remove both, spatial and temporal redundancies, two different alternatives are
available:
     </p><ol class='enumerate1'>
<li class='enumerate' id='x1-15002x1'>In a <span class='ecbx-1000'>“t+2D” transform</span>, the video is first analyzed (transformed) along
     the time domain and next, over the space domain.
     </li>
                                                                  

                                                                  
<li class='enumerate' id='x1-15004x2'>A <span class='ecbx-1000'>“2D+t” transform </span>does just the opposite.</li></ol>
<!-- l. 514 --><p class='noindent'>Each choice has a number of <span class='ecti-1000'>pros </span>and <span class='ecti-1000'>cons</span>. For example, in a “t+2D” transform we can
apply directly any <a href='https://vicente-gonzalez-ruiz.github.io/video_compression/'>frame predictor</a> based on <a href='https://en.wikipedia.org/wiki/Motion_estimation'>Motion Estimation (ME)</a> because the
input is a normal video. On the contrary, if we implement a “2D+t” transform, the
input to the motion estimator is a sequence of decompositions. <a href='http://www.polyvalens.com/blog/wavelets/theory'>The overwhelming
majority of DWT’s</a> are not <a href='http://www.polyvalens.com/blog/wavelets/theory'>shift invariant</a>, which basically means that, exactly the
same object placed in two different frames in different positions will generate different
wavelet coefficients, even if the displacement is an integer number of pixels and
therefore, the pixels of the object in both frames are identical. Therefore, motion
estimators that compare coefficient values will not work with accuracy on the
decomposition domain. On the other hand, if we want to provide true spatial
scalability (processing only those <a href='https://www.tutorialspoint.com/dip/spatial_resolution.htm'>spatial resolutions</a> (scales) necessary to get a
spatially scaled of our video), a “t+2D” transformed video presents several
drawbacks:
</p><!-- l. 536 --><p class='indent'>
     </p><ol class='enumerate1'>
<li class='enumerate' id='x1-15006x1'>The perfect reconstruction of the original frames only is possible if the “t”
     stage is identical at both, the <a href='https://en.wikipedia.org/wiki/Encoder'>encoder</a> and the <a href='https://en.wikipedia.org/wiki/Decoder'>decoder</a>. Therefore, if the
     encoder applies “t” at the full resolution (scale 0), the decoder must apply
     “t” also at full resolution, even if the resolution of the reconstructed frames
     were smaller. This could be unfeasible for receivers with low computational
     resourcers.
     </li>
<li class='enumerate' id='x1-15008x2'>Perfect reconstruction can be sacrified by using a quantized version of the
     motion information, but the rate/distortion (R/D) tradeoff will be worst.
     In this case, also, the decoder would be wasting motion information.
     </li>
<li class='enumerate' id='x1-15010x3'>This last problem (the waste of motion information) could be avoided if
     the motion data were encoded in a progressive representation (suitable
     for working in a different spatial resolution of the frames). Unfortunately,
     progressive representations usually need more data than non-progressive
     ones. Moreover, it is not trivial to pack the motion data and the texture
     data in a single code-stream to provide all the posible types of scalability
     (temporal, spatial, and quality).</li></ol>
                                                                  

                                                                  
<!-- l. 561 --><p class='noindent'>
</p>
   <h3 class='sectionHead'><span class='titlemark'>8   </span> <a id='x1-160008'></a>DWT structures and Laplacian Pyramids</h3>
<!-- l. 564 --><p class='noindent'>This, as it will be seen after, shift variance of the wavelet coefficients is a
problem when we want to perform comparisons in the DWT domain. As
it can be supposded, this problem can be mitigated if the downsampling
operation is removed, as happens in the <a href='https://ieeexplore.ieee.org/document/1408191'>Overcomplete DWT</a> and in the
<a href='http://fourier.eng.hmc.edu/e161/lectures/canny/node3.html'>Laplacian Pyramids</a> (LP). Fortunately, there is an equivalence between DWT
subbands and a family of Laplacian Pyramids that we will call Orthogonal
LP’s (OLP’s), and it is quite straightforward to <a href='https://vicente-gonzalez-ruiz.github.io/pyramids-and-wavelets/'>convert a decomposition
representation into a pyramid representation and viceversa</a>, when the \(L\) and \(H\) filters
are used for both, the DWT and the LP, are orghogonal. If the filters used
for generating the LP were not orthogonal, then it would not be possible
to travel from the LP domain through the DWT domain without lossing
information.
</p><!-- l. 583 --><p class='noindent'>
</p>
   <h3 class='sectionHead'><span class='titlemark'>9   </span> <a id='x1-170009'></a>Motion Compensated Orthogonal Laplacian Pyramid (MCOLP)</h3>
<!-- l. 586 --><p class='noindent'>MCOLP is a “2D+t” transform. The “2D” stage is an 1-iteration MDWT, and the “t”
stage is basicallt a \(T\)-iterations 1D <a href='https://en.wikipedia.org/wiki/Motion_compensation'>Motion Compensated (MC)</a> DWT. The MDWT
removes the spatial redundancy of the video, and the temporal DWT removes the
temporal redundancy between \(H\) subbands. The number of iterations \(T\) determines the
<a href='https://en.wikipedia.org/wiki/Group_of_pictures'>GOP</a> size \begin {equation}  G=2^T. \label {eq:GOP_size}  \end {equation}<a id='x1-17001r1'></a>
</p><!-- l. 598 --><p class='indent'>   We can think of MCLOPT such as a <a href='https://ieeexplore.ieee.org/abstract/document/1369697'>MCTF</a> applied to a given spatial resolution
level, and because the motion is estimated using the previous lower resolution level
(which is available at the decoder), it is not necessary to send the motion information
in the code-stream. Notice also that this process can be used for any number of
spatial resolution levels, simply by using MCLOPT iteratively on the low spatial
resolution level (resulting of the previous iteration of MRVC that applies first a
MDWT).
</p><!-- l. 608 --><p class='indent'>   A peculiar feature of MCLOP is that the predict step used in the “t”-DWT is
performed in the OLP domain, which is shift invariant because the coefficients have
not been downsampled (as happens in the DWT domain).
</p><!-- l. 615 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>9.1   </span> <a id='x1-180009.1'></a>The MCOLP butterfly</h4>
<!-- l. 618 --><p class='noindent'>The butterly inputs three decompositions \(a=\{a.L, a.H\}\), \(b=\{b.L, b.H\}\) and \(c=\{c.L, c.H\}\), and outputs a residue subband \(\tilde {b}.H\),
which replaces to \(b.H\) in the original \(b\) decomposition. Therefore, after the use of the
bufferfly, we get \(a\) , \(\tilde {b}=\{b.L, \tilde {b}.H\}\) (notice that only the high-frequency information of \(b\) has been
compensated) and \(c\). This replacement is fully reversible because the forward
                                                                  

                                                                  
transform uses only the information that the inverse transform will have access
to.
</p><!-- l. 627 --><p class='indent'>   Notice that the <a href='http://www.vtvt.ece.vt.edu/research/references/video/DCT_Video_Compression/Zhang92a.pdf'>pyramid domain</a> (which is near-invariant to the pixels
displacements) has been used to estimate and compensate the \(H\) subbands. This means
that the motion has been estimated using integer (not sub-) pixel accuracy, and that
the motion has been compensated also integer pixel accuracy in the OLP domain,
that implies \(1/2\)-pixel accuracy in the DWT domain.
</p><!-- l. 636 --><p class='indent'>   After the MC, a DWT is computed to \(\tilde {b}.H\) in order to get again a critically sampled
version these subbands. After this, the \(b.L\) subband is discarded (in fact, replaced by the
original subband). The MC operation can generate information in this subband,
because the MC can produce low-frequency information that could not be
represented by the \(H\) subband. However, hopefully the energy of the \(L\) subband
is going to be small in most of the cases, and in any case, this is not an
unsolvable problem because the decoder is going to replicate exactly this
behaviour.
</p>
   <figure class='figure'> 

                                                                  

                                                                  
                                                                  

                                                                  
<!-- l. 647 --><p class='noindent'><div style='text-align:center;'> <img src='graphics/forward_butterfly.svg' /> </div>   </p><!-- l. 650 --><pre class='lstinputlisting' id='listing-3'><span class='label'><a id='x1-18003r1'></a></span><span style='color:#000000'><span class='ectt-1000'> lass</span></span><span style='color:#000000'> <span class='ectt-1000'>MCOLP:</span> 
</span><span class='label'><a id='x1-18004r2'></a></span> 
<span class='label'><a id='x1-18005r3'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>def</span></span><span style='color:#000000'> <span class='ectt-1000'>__init__(self, </span><span class='ectt-1000'>shape, </span><span class='ectt-1000'>wavelet </span><span class='ectt-1000'>= </span><span class='ectt-1000'>"bior3.5"):</span> 
</span><span class='label'><a id='x1-18006r4'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>self</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>zero_L</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>np.zeros(shape, </span><span class='ectt-1000'>np.float64)</span> 
</span><span class='label'><a id='x1-18007r5'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>self</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>zero_H</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>(np.zeros(shape, </span><span class='ectt-1000'>np.float64), </span><span class='ectt-1000'>np.zeros(shape, </span><span class='ectt-1000'>np.float64), </span><span class='ectt-1000'>np.zeros(shape, </span><span class='ectt-1000'>np.float64))</span> 
</span><span class='label'><a id='x1-18008r6'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>self</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>dwt</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>DWT(wavelet)</span> 
</span><span class='label'><a id='x1-18009r7'></a></span> 
<span class='label'><a id='x1-18010r8'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>def</span></span><span style='color:#000000'> <span class='ectt-1000'>__forward_butterfly(self, </span><span class='ectt-1000'>aL, </span><span class='ectt-1000'>aH, </span><span class='ectt-1000'>bL, </span><span class='ectt-1000'>bH, </span><span class='ectt-1000'>cL, </span><span class='ectt-1000'>cH):</span> 
</span><span class='label'><a id='x1-18011r9'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='tcit-1000'>'''</span></span><span style='color:#000000'><span class='ecit-1000'>Forward</span></span><span style='color:#000000'> <span class='ecit-1000'>MCOLP </span><span class='ecit-1000'>butterfly.</span> 
</span><span class='label'><a id='x1-18012r10'></a></span> 
<span class='label'><a id='x1-18013r11'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Input</span></span><span style='color:#000000'><span class='ecit-1000'>:</span></span> 
<span class='label'><a id='x1-18014r12'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>-----</span></span> 
<span class='label'><a id='x1-18015r13'></a></span> 
<span class='label'><a id='x1-18016r14'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>aL</span></span><span style='color:#000000'><span class='ecit-1000'>,</span></span><span style='color:#000000'> <span class='ecit-1000'>aH, </span><span class='ecit-1000'>bL, </span><span class='ecit-1000'>bH, </span><span class='ecit-1000'>cL, </span><span class='ecit-1000'>cH: </span><span class='ecit-1000'>array[y, </span><span class='ecit-1000'>x, </span><span class='ecit-1000'>component], </span><span class='ecit-1000'>the </span><span class='ecit-1000'>decomposition </span><span class='ecit-1000'>of</span> 
</span><span class='label'><a id='x1-18017r15'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>the</span></span><span style='color:#000000'> <span class='ecit-1000'>images </span><span class='ecit-1000'>a, </span><span class='ecit-1000'>b </span><span class='ecit-1000'>and </span><span class='ecit-1000'>c.</span> 
</span><span class='label'><a id='x1-18018r16'></a></span> 
<span class='label'><a id='x1-18019r17'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Output</span></span><span style='color:#000000'><span class='ecit-1000'>:</span></span> 
<span class='label'><a id='x1-18020r18'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>------</span></span> 
<span class='label'><a id='x1-18021r19'></a></span> 
<span class='label'><a id='x1-18022r20'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>residue_bH</span></span><span style='color:#000000'><span class='ecit-1000'>:</span></span><span style='color:#000000'> <span class='ecit-1000'>array[y, </span><span class='ecit-1000'>x, </span><span class='ecit-1000'>component], </span><span class='ecit-1000'>the </span><span class='ecit-1000'>residue </span><span class='ecit-1000'>of </span><span class='ecit-1000'>the</span> 
</span><span class='label'><a id='x1-18023r21'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>high</span></span><span style='color:#000000'><span class='ecit-1000'>-</span></span><span style='color:#000000'><span class='ecit-1000'>requency</span></span><span style='color:#000000'> <span class='ecit-1000'>information </span><span class='ecit-1000'>of </span><span class='ecit-1000'>the </span><span class='ecit-1000'>image </span><span class='ecit-1000'>b.</span> 
</span><span class='label'><a id='x1-18024r22'></a></span> 
<span class='label'><a id='x1-18025r23'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='tcit-1000'>'''</span></span> 
<span class='label'><a id='x1-18026r24'></a></span> 
<span class='label'><a id='x1-18027r25'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>AL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.dwt.backward((aL, </span><span class='ectt-1000'>self.zero_H))</span> 
</span><span class='label'><a id='x1-18028r26'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>BL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.dwt.backward((bL, </span><span class='ectt-1000'>self.zero_H))</span> 
</span><span class='label'><a id='x1-18029r27'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>CL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.dwt.backward((cL, </span><span class='ectt-1000'>self.zero_H))</span> 
</span><span class='label'><a id='x1-18030r28'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>AH</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.dwt.backward((self.zero_L, </span><span class='ectt-1000'>aH))</span> 
</span><span class='label'><a id='x1-18031r29'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>BH</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.dwt.backward((self.zero_L, </span><span class='ectt-1000'>bH))</span> 
</span><span class='label'><a id='x1-18032r30'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>CH</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.dwt.backward((self.zero_L, </span><span class='ectt-1000'>cH))</span> 
</span><span class='label'><a id='x1-18033r31'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>prediction_BH</span></span><span style='color:#000000'> </span><span class='ectt-1000'> </span><span style='color:#000000'><span class='ectt-1000'>=</span></span><span style='color:#000000'> <span class='ectt-1000'>predictor.generate_prediction(AL, </span><span class='ectt-1000'>BL, </span><span class='ectt-1000'>CL, </span><span class='ectt-1000'>AH, </span><span class='ectt-1000'>CH)</span> 
</span><span class='label'><a id='x1-18034r32'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>residue_BH</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>BH </span><span class='ectt-1000'>- </span><span class='ectt-1000'>prediction_BH</span> 
</span><span class='label'><a id='x1-18035r33'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>residue_bH</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.dwt.forward(residue_BH)</span> 
</span><span class='label'><a id='x1-18036r34'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>return</span></span><span style='color:#000000'> <span class='ectt-1000'>residue_bH[1]</span> 
</span><span class='label'><a id='x1-18037r35'></a></span> 
<span class='label'><a id='x1-18038r36'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>def</span></span><span style='color:#000000'> <span class='ectt-1000'>__backward_butterfly(self, </span><span class='ectt-1000'>aL, </span><span class='ectt-1000'>aH, </span><span class='ectt-1000'>bL, </span><span class='ectt-1000'>residue_bH, </span><span class='ectt-1000'>cL, </span><span class='ectt-1000'>cH):</span> 
</span><span class='label'><a id='x1-18039r37'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='tcit-1000'>'''</span></span><span style='color:#000000'><span class='ecit-1000'>Backward</span></span><span style='color:#000000'> <span class='ecit-1000'>MCOLP </span><span class='ecit-1000'>butterfly.</span> 
</span><span class='label'><a id='x1-18040r38'></a></span> 
<span class='label'><a id='x1-18041r39'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Input</span></span><span style='color:#000000'><span class='ecit-1000'>:</span></span> 
<span class='label'><a id='x1-18042r40'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>-----</span></span> 
<span class='label'><a id='x1-18043r41'></a></span> 
<span class='label'><a id='x1-18044r42'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>aL</span></span><span style='color:#000000'><span class='ecit-1000'>,</span></span><span style='color:#000000'> <span class='ecit-1000'>aH, </span><span class='ecit-1000'>bL, </span><span class='ecit-1000'>residue_bH, </span><span class='ecit-1000'>cL, </span><span class='ecit-1000'>cH: </span><span class='ecit-1000'>array[y, </span><span class='ecit-1000'>x, </span><span class='ecit-1000'>component], </span><span class='ecit-1000'>the</span> 
</span><span class='label'><a id='x1-18045r43'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>\</span></span><span style='color:#000000'><span class='ecit-1000'>tilde</span></span><span style='color:#000000'><span class='ecit-1000'>{</span></span><span style='color:#000000'><span class='ecit-1000'>b</span></span><span style='color:#000000'><span class='ecit-1000'>}</span></span><span style='color:#000000'> <span class='ecit-1000'>image.</span> 
</span><span class='label'><a id='x1-18046r44'></a></span> 
<span class='label'><a id='x1-18047r45'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Output</span></span><span style='color:#000000'><span class='ecit-1000'>:</span></span> 
<span class='label'><a id='x1-18048r46'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>------</span></span> 
<span class='label'><a id='x1-18049r47'></a></span> 
<span class='label'><a id='x1-18050r48'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>bH</span></span><span style='color:#000000'><span class='ecit-1000'>:</span></span><span style='color:#000000'> <span class='ecit-1000'>array[y, </span><span class='ecit-1000'>x, </span><span class='ecit-1000'>component], </span><span class='ecit-1000'>the </span><span class='ecit-1000'>high-frequencies </span><span class='ecit-1000'>of </span><span class='ecit-1000'>the </span><span class='ecit-1000'>image</span> 
</span><span class='label'><a id='x1-18051r49'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>b</span></span><span style='color:#000000'><span class='ecit-1000'>.</span></span> 
<span class='label'><a id='x1-18052r50'></a></span> 
<span class='label'><a id='x1-18053r51'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='tcit-1000'>'''</span></span> 
<span class='label'><a id='x1-18054r52'></a></span> 
<span class='label'><a id='x1-18055r53'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>AL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.dwt.backward((aL, </span><span class='ectt-1000'>self.zero_H))</span> 
</span><span class='label'><a id='x1-18056r54'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>BL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.dwt.backward((bL, </span><span class='ectt-1000'>self.zero_H))</span> 
</span><span class='label'><a id='x1-18057r55'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>CL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.dwt.backward((cL, </span><span class='ectt-1000'>self.zero_H))</span> 
</span><span class='label'><a id='x1-18058r56'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>AH</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.dwt.backward((self.zero_L, </span><span class='ectt-1000'>aH))</span> 
</span><span class='label'><a id='x1-18059r57'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>residue_BH</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.dwt.backward((self.zero_L, </span><span class='ectt-1000'>residue_bH))</span> 
</span><span class='label'><a id='x1-18060r58'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>CH</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.dwt.backward((self.zero_L, </span><span class='ectt-1000'>cH))</span> 
</span><span class='label'><a id='x1-18061r59'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>prediction_BH</span></span><span style='color:#000000'> </span><span class='ectt-1000'> </span><span style='color:#000000'><span class='ectt-1000'>=</span></span><span style='color:#000000'> <span class='ectt-1000'>predictor.generate_prediction(AL, </span><span class='ectt-1000'>BL, </span><span class='ectt-1000'>CL, </span><span class='ectt-1000'>AH, </span><span class='ectt-1000'>CH)</span> 
</span><span class='label'><a id='x1-18062r60'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>BH</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>residue_BH </span><span class='ectt-1000'>+ </span><span class='ectt-1000'>prediction_BH</span> 
</span><span class='label'><a id='x1-18063r61'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>bH</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.dwt.forward(BH)</span> 
</span><span class='label'><a id='x1-18064r62'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>return</span></span><span style='color:#000000'> <span class='ectt-1000'>bH[1]</span></span>
</pre>
<!-- l. 653 --><pre class='lstinputlisting' id='listing-4'><span class='label'><a id='x1-18067r1'></a></span> 
<span class='label'><a id='x1-18068r2'></a></span><span style='color:#000000'><span class='ectt-1000'> ef</span></span><span style='color:#000000'> <span class='ectt-1000'>generate_prediction(aL, </span><span class='ectt-1000'>bL, </span><span class='ectt-1000'>cL, </span><span class='ectt-1000'>AH, </span><span class='ectt-1000'>CH):</span> 
</span><span class='label'><a id='x1-18069r3'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>flow_AL_BL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>motion_estimation(aL, </span><span class='ectt-1000'>bL)</span> 
</span><span class='label'><a id='x1-18070r4'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>flow_CL_BL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>motion_estimation(cL, </span><span class='ectt-1000'>bL)</span> 
</span><span class='label'><a id='x1-18071r5'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>flow_AL_BL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>DWT.backward((flow_AL_BL, </span><span class='ectt-1000'>[None, </span><span class='ectt-1000'>None, </span><span class='ectt-1000'>None]))</span> 
</span><span class='label'><a id='x1-18072r6'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>flow_CL_BL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>DWT.backward((flow_CL_BL, </span><span class='ectt-1000'>[None, </span><span class='ectt-1000'>None, </span><span class='ectt-1000'>None]))</span></span>
</pre>
<a id='x1-18073r5'></a>
<figcaption class='caption'><span class='id'>Figure 5: </span><span class='content'>Forward and inverse MCOLP butterflies, and computation of the
prediction frame.                                                   </span></figcaption><!-- tex4ht:label?: x1-18073r5  -->
                                                                  

                                                                  
   </figure>
   <h4 class='subsectionHead'><span class='titlemark'>9.2   </span> <a id='x1-190009.2'></a>The MCOLP transform</h4>
<!-- l. 680 --><p class='noindent'>The \(T\)-iterations MCOLP (see Fig. <a href='#x1-19105r6'>6<!-- tex4ht:ref: fig:MCOLP  --></a>) is the result of applying the MCOLP butterfly
to all the frames at \(T\) different temporal subsamplings (or scales). At the iteration \(1\leq t\leq T\) of
MCOLP, the involved frames are multiple of \(2^t\).
</p>
   <figure class='figure'> 

                                                                  

                                                                  
                                                                  

                                                                  
<!-- l. 688 --><pre class='lstinputlisting' id='listing-5'><span class='label'><a id='x1-19003r1'></a></span> <span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>def</span></span><span style='color:#000000'> <span class='ectt-1000'>forward(self, </span><span class='ectt-1000'>prefix </span><span class='ectt-1000'>= </span><span class='ectt-1000'>"/tmp/", </span><span class='ectt-1000'>N=5, </span><span class='ectt-1000'>T=2):</span> 
</span><span class='label'><a id='x1-19004r2'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='tcit-1000'>'''</span></span><span style='color:#000000'><span class='ecit-1000'>Forward</span></span><span style='color:#000000'> <span class='ecit-1000'>MCOLP.</span> 
</span><span class='label'><a id='x1-19005r3'></a></span> 
<span class='label'><a id='x1-19006r4'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Compute</span></span><span style='color:#000000'> <span class='ecit-1000'>a </span><span class='ecit-1000'>MC </span><span class='ecit-1000'>1D-DWT, </span><span class='ecit-1000'>estimating </span><span class='ecit-1000'>in </span><span class='ecit-1000'>the </span><span class='ecit-1000'>L </span><span class='ecit-1000'>subbands </span><span class='ecit-1000'>and</span> 
</span><span class='label'><a id='x1-19007r5'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>compensaing</span></span><span style='color:#000000'> <span class='ecit-1000'>in </span><span class='ecit-1000'>the </span><span class='ecit-1000'>H </span><span class='ecit-1000'>subbands </span><span class='ecit-1000'>of </span><span class='ecit-1000'>the </span><span class='ecit-1000'>Orthogonal </span><span class='ecit-1000'>Laplacian</span> 
</span><span class='label'><a id='x1-19008r6'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Pyramid</span></span><span style='color:#000000'><span class='ecit-1000'>.</span></span><span style='color:#000000'> <span class='ecit-1000'>The </span><span class='ecit-1000'>input </span><span class='ecit-1000'>video </span><span class='ecit-1000'>(as </span><span class='ecit-1000'>a </span><span class='ecit-1000'>sequence </span><span class='ecit-1000'>of </span><span class='ecit-1000'>1-iteration</span> 
</span><span class='label'><a id='x1-19009r7'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>decompositions</span></span><span style='color:#000000'><span class='ecit-1000'>)</span></span><span style='color:#000000'> <span class='ecit-1000'>must </span><span class='ecit-1000'>be </span><span class='ecit-1000'>stored </span><span class='ecit-1000'>in </span><span class='ecit-1000'>disk </span><span class='ecit-1000'>in </span><span class='ecit-1000'>the </span><span class='ecit-1000'>directory</span> 
</span><span class='label'><a id='x1-19010r8'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>&lt;</span></span><span style='color:#000000'><span class='ecit-1000'>prefix</span></span><span style='color:#000000'><span class='ecit-1000'>&gt;,</span></span><span style='color:#000000'> <span class='ecit-1000'>and </span><span class='ecit-1000'>the </span><span class='ecit-1000'>output </span><span class='ecit-1000'>(as </span><span class='ecit-1000'>a </span><span class='ecit-1000'>1-iteration </span><span class='ecit-1000'>MC </span><span class='ecit-1000'>decompositions)</span> 
</span><span class='label'><a id='x1-19011r9'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>will</span></span><span style='color:#000000'> <span class='ecit-1000'>generated </span><span class='ecit-1000'>in </span><span class='ecit-1000'>the </span><span class='ecit-1000'>same </span><span class='ecit-1000'>directory.</span> 
</span><span class='label'><a id='x1-19012r10'></a></span> 
<span class='label'><a id='x1-19013r11'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Input</span></span> 
<span class='label'><a id='x1-19014r12'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>-----</span></span> 
<span class='label'><a id='x1-19015r13'></a></span> 
<span class='label'><a id='x1-19016r14'></a></span><span class='ecit-1000'>            </span><span style='color:#000000'><span class='ecit-1000'>prefix</span></span><span style='color:#000000'> <span class='ecit-1000'>: </span><span class='ecit-1000'>str</span> 
</span><span class='label'><a id='x1-19017r15'></a></span> 
<span class='label'><a id='x1-19018r16'></a></span><span class='ecit-1000'>                </span><span style='color:#000000'><span class='ecit-1000'>Localization</span></span><span style='color:#000000'> <span class='ecit-1000'>of </span><span class='ecit-1000'>the </span><span class='ecit-1000'>input/output </span><span class='ecit-1000'>images. </span><span class='ecit-1000'>Example:</span> 
</span><span class='label'><a id='x1-19019r17'></a></span><span class='ecit-1000'>                </span><span style='color:#000000'><span class='ecit-1000'>"/</span></span><span style='color:#000000'><span class='ecit-1000'>tmp</span></span><span style='color:#000000'><span class='ecit-1000'>/".</span></span> 
<span class='label'><a id='x1-19020r18'></a></span> 
<span class='label'><a id='x1-19021r19'></a></span><span class='ecit-1000'>             </span><span style='color:#000000'><span class='ecit-1000'>N</span></span><span style='color:#000000'> <span class='ecit-1000'>: </span><span class='ecit-1000'>int</span> 
</span><span class='label'><a id='x1-19022r20'></a></span> 
<span class='label'><a id='x1-19023r21'></a></span><span class='ecit-1000'>                </span><span style='color:#000000'><span class='ecit-1000'>Number</span></span><span style='color:#000000'> <span class='ecit-1000'>of </span><span class='ecit-1000'>decompositions </span><span class='ecit-1000'>to </span><span class='ecit-1000'>process.</span> 
</span><span class='label'><a id='x1-19024r22'></a></span> 
<span class='label'><a id='x1-19025r23'></a></span><span class='ecit-1000'>             </span><span style='color:#000000'><span class='ecit-1000'>T</span></span><span style='color:#000000'> <span class='ecit-1000'>: </span><span class='ecit-1000'>int</span> 
</span><span class='label'><a id='x1-19026r24'></a></span> 
<span class='label'><a id='x1-19027r25'></a></span><span class='ecit-1000'>                </span><span style='color:#000000'><span class='ecit-1000'>Number</span></span><span style='color:#000000'> <span class='ecit-1000'>of </span><span class='ecit-1000'>iterations </span><span class='ecit-1000'>of </span><span class='ecit-1000'>the </span><span class='ecit-1000'>MCOLP </span><span class='ecit-1000'>(temporal </span><span class='ecit-1000'>scales).</span> 
</span><span class='label'><a id='x1-19028r26'></a></span><span class='ecit-1000'>                </span><span style='color:#000000'><span class='ecit-1000'>Controls</span></span><span style='color:#000000'> <span class='ecit-1000'>the </span><span class='ecit-1000'>GOP </span><span class='ecit-1000'>size.</span> 
</span><span class='label'><a id='x1-19029r27'></a></span> 
<span class='label'><a id='x1-19030r28'></a></span><span class='ecit-1000'>                  </span><span style='color:#000000'><span class='ecit-1000'>T</span></span><span style='color:#000000'> <span class='ecit-1000'>| </span><span class='ecit-1000'>GOP_size</span> 
</span><span class='label'><a id='x1-19031r29'></a></span><span class='ecit-1000'>                </span><span style='color:#000000'><span class='ecit-1000'>----+----------</span></span> 
<span class='label'><a id='x1-19032r30'></a></span><span class='ecit-1000'>                  </span><span style='color:#000000'><span class='ecit-1000'>0</span></span><span style='color:#000000'> <span class='ecit-1000'>|</span> </span><span class='ecit-1000'>       </span><span style='color:#000000'><span class='ecit-1000'>1</span></span> 
<span class='label'><a id='x1-19033r31'></a></span><span class='ecit-1000'>                  </span><span style='color:#000000'><span class='ecit-1000'>1</span></span><span style='color:#000000'> <span class='ecit-1000'>|</span> </span><span class='ecit-1000'>       </span><span style='color:#000000'><span class='ecit-1000'>2</span></span> 
<span class='label'><a id='x1-19034r32'></a></span><span class='ecit-1000'>                  </span><span style='color:#000000'><span class='ecit-1000'>2</span></span><span style='color:#000000'> <span class='ecit-1000'>|</span> </span><span class='ecit-1000'>       </span><span style='color:#000000'><span class='ecit-1000'>4</span></span> 
<span class='label'><a id='x1-19035r33'></a></span><span class='ecit-1000'>                  </span><span style='color:#000000'><span class='ecit-1000'>3</span></span><span style='color:#000000'> <span class='ecit-1000'>|</span> </span><span class='ecit-1000'>       </span><span style='color:#000000'><span class='ecit-1000'>8</span></span> 
<span class='label'><a id='x1-19036r34'></a></span><span class='ecit-1000'>                  </span><span style='color:#000000'><span class='ecit-1000'>4</span></span><span style='color:#000000'> <span class='ecit-1000'>|</span> </span><span class='ecit-1000'>      </span><span style='color:#000000'><span class='ecit-1000'>16</span></span> 
<span class='label'><a id='x1-19037r35'></a></span><span class='ecit-1000'>                  </span><span style='color:#000000'><span class='ecit-1000'>5</span></span><span style='color:#000000'> <span class='ecit-1000'>|</span> </span><span class='ecit-1000'>      </span><span style='color:#000000'><span class='ecit-1000'>32</span></span> 
<span class='label'><a id='x1-19038r36'></a></span><span class='ecit-1000'>                  </span><span style='color:#000000'><span class='ecit-1000'>:</span></span><span style='color:#000000'> <span class='ecit-1000'>|</span> </span><span class='ecit-1000'>       </span><span style='color:#000000'><span class='ecit-1000'>:</span></span> 
<span class='label'><a id='x1-19039r37'></a></span> 
<span class='label'><a id='x1-19040r38'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Returns</span></span> 
<span class='label'><a id='x1-19041r39'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>-------</span></span> 
<span class='label'><a id='x1-19042r40'></a></span> 
<span class='label'><a id='x1-19043r41'></a></span><span class='ecit-1000'>            </span><span style='color:#000000'><span class='ecit-1000'>The</span></span><span style='color:#000000'> <span class='ecit-1000'>output </span><span class='ecit-1000'>motion </span><span class='ecit-1000'>compensated </span><span class='ecit-1000'>decompositions.</span> 
</span><span class='label'><a id='x1-19044r42'></a></span> 
<span class='label'><a id='x1-19045r43'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='tcit-1000'>'''</span></span> 
<span class='label'><a id='x1-19046r44'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>x</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>2</span> 
</span><span class='label'><a id='x1-19047r45'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>for</span></span><span style='color:#000000'> <span class='ectt-1000'>t </span><span class='ectt-1000'>in </span><span class='ectt-1000'>range(T): </span><span class='ecit-1000'># </span><span class='ecit-1000'>Temporal </span><span class='ecit-1000'>scale</span> 
</span><span class='label'><a id='x1-19048r46'></a></span><span class='ecit-1000'>            </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>print</span></span><span style='color:#000000'><span class='ecit-1000'>("</span></span><span style='color:#000000'><span class='ecit-1000'>a</span></span><span style='color:#000000'><span class='ecit-1000'>={}".</span></span><span style='color:#000000'><span class='ecit-1000'>format</span></span><span style='color:#000000'><span class='ecit-1000'>(0),</span></span><span style='color:#000000'> <span class='ecit-1000'>end=</span><span class='tcit-1000'>' </span><span class='tcit-1000'>'</span><span class='ecit-1000'>)</span> 
</span><span class='label'><a id='x1-19049r47'></a></span><span class='ectt-1000'>            </span><span style='color:#000000'><span class='ectt-1000'>i</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>0</span> 
</span><span class='label'><a id='x1-19050r48'></a></span><span class='ectt-1000'>            </span><span style='color:#000000'><span class='ectt-1000'>aL</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'> <span class='ectt-1000'>aH </span><span class='ectt-1000'>= </span><span class='ectt-1000'>decomposition.read(prefix, </span><span class='ectt-1000'>"{:03d}".format(0))</span> 
</span><span class='label'><a id='x1-19051r49'></a></span><span class='ectt-1000'>            </span><span style='color:#000000'><span class='ectt-1000'>while</span></span><span style='color:#000000'> <span class='ectt-1000'>i </span><span class='ectt-1000'>&lt; </span><span class='ectt-1000'>(N//x):</span> 
</span><span class='label'><a id='x1-19052r50'></a></span><span class='ecit-1000'>                </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>print</span></span><span style='color:#000000'><span class='ecit-1000'>("</span></span><span style='color:#000000'><span class='ecit-1000'>b</span></span><span style='color:#000000'><span class='ecit-1000'>={}</span></span><span style='color:#000000'> <span class='ecit-1000'>c={}".format(x*i+x//2, </span><span class='ecit-1000'>x*i+x))</span> 
</span><span class='label'><a id='x1-19053r51'></a></span><span class='ectt-1000'>                </span><span style='color:#000000'><span class='ectt-1000'>bL</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'> <span class='ectt-1000'>bH </span><span class='ectt-1000'>= </span><span class='ectt-1000'>decomposition.read(prefix, </span><span class='ectt-1000'>"{:03d}".format(x*i+x//2))</span> 
</span><span class='label'><a id='x1-19054r52'></a></span><span class='ectt-1000'>                </span><span style='color:#000000'><span class='ectt-1000'>cL</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'> <span class='ectt-1000'>cH </span><span class='ectt-1000'>= </span><span class='ectt-1000'>decomposition.read(prefix, </span><span class='ectt-1000'>"{:03d}".format(x*i+x))</span> 
</span><span class='label'><a id='x1-19055r53'></a></span><span class='ectt-1000'>                </span><span style='color:#000000'><span class='ectt-1000'>residue_bH</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.__forward_butterfly(aL, </span><span class='ectt-1000'>aH, </span><span class='ectt-1000'>bL, </span><span class='ectt-1000'>bH, </span><span class='ectt-1000'>cL, </span><span class='ectt-1000'>cH)</span> 
</span><span class='label'><a id='x1-19056r54'></a></span><span class='ectt-1000'>                </span><span style='color:#000000'><span class='ectt-1000'>decomposition</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>writeH</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>residue_bH</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'> <span class='ectt-1000'>prefix, </span><span class='ectt-1000'>"{:03d}".format(x*i+x//2))</span> 
</span><span class='label'><a id='x1-19057r55'></a></span><span class='ectt-1000'>                </span><span style='color:#000000'><span class='ectt-1000'>aL</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'> <span class='ectt-1000'>aH </span><span class='ectt-1000'>= </span><span class='ectt-1000'>cL, </span><span class='ectt-1000'>cH</span> 
</span><span class='label'><a id='x1-19058r56'></a></span><span class='ecit-1000'>                </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>print</span></span><span style='color:#000000'><span class='ecit-1000'>("</span></span><span style='color:#000000'><span class='ecit-1000'>a</span></span><span style='color:#000000'><span class='ecit-1000'>={}".</span></span><span style='color:#000000'><span class='ecit-1000'>format</span></span><span style='color:#000000'><span class='ecit-1000'>(</span></span><span style='color:#000000'><span class='ecit-1000'>x</span></span><span style='color:#000000'><span class='ecit-1000'>*</span></span><span style='color:#000000'><span class='ecit-1000'>i</span></span><span style='color:#000000'><span class='ecit-1000'>+</span></span><span style='color:#000000'><span class='ecit-1000'>x</span></span><span style='color:#000000'><span class='ecit-1000'>),</span></span><span style='color:#000000'> <span class='ecit-1000'>end=</span><span class='tcit-1000'>' </span><span class='tcit-1000'>'</span><span class='ecit-1000'>)</span> 
</span><span class='label'><a id='x1-19059r57'></a></span><span class='ectt-1000'>                </span><span style='color:#000000'><span class='ectt-1000'>i</span></span><span style='color:#000000'> <span class='ectt-1000'>+= </span><span class='ectt-1000'>1</span> 
</span><span class='label'><a id='x1-19060r58'></a></span><span class='ectt-1000'>            </span><span style='color:#000000'><span class='ectt-1000'>x</span></span><span style='color:#000000'> <span class='ectt-1000'>*= </span><span class='ectt-1000'>2</span> 
</span><span class='label'><a id='x1-19061r59'></a></span><span class='ecit-1000'>            </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'>print</span></span><span style='color:#000000'><span class='ecit-1000'>(</span><span class='tcit-1000'>'</span><span class='ecit-1000'>\</span></span><span style='color:#000000'><span class='ecit-1000'>n</span></span><span style='color:#000000'><span class='tcit-1000'>'</span><span class='ecit-1000'>)</span></span> 
<span class='label'><a id='x1-19062r60'></a></span> 
<span class='label'><a id='x1-19063r61'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>def</span></span><span style='color:#000000'> <span class='ectt-1000'>backward(self, </span><span class='ectt-1000'>prefix </span><span class='ectt-1000'>= </span><span class='ectt-1000'>"/tmp/", </span><span class='ectt-1000'>N=5, </span><span class='ectt-1000'>T=2):</span> 
</span><span class='label'><a id='x1-19064r62'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='tcit-1000'>'''</span></span><span style='color:#000000'><span class='ecit-1000'>Backward</span></span><span style='color:#000000'> <span class='ecit-1000'>MCOLP.</span> 
</span><span class='label'><a id='x1-19065r63'></a></span> 
<span class='label'><a id='x1-19066r64'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Compute</span></span><span style='color:#000000'> <span class='ecit-1000'>the </span><span class='ecit-1000'>inverse </span><span class='ecit-1000'>MC </span><span class='ecit-1000'>1D-DWT. </span><span class='ecit-1000'>The </span><span class='ecit-1000'>input </span><span class='ecit-1000'>sequence </span><span class='ecit-1000'>of</span> 
</span><span class='label'><a id='x1-19067r65'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>1-</span></span><span style='color:#000000'><span class='ecit-1000'>iteration</span></span><span style='color:#000000'> <span class='ecit-1000'>MC </span><span class='ecit-1000'>decompositions </span><span class='ecit-1000'>must </span><span class='ecit-1000'>be </span><span class='ecit-1000'>stored </span><span class='ecit-1000'>in </span><span class='ecit-1000'>disk </span><span class='ecit-1000'>in </span><span class='ecit-1000'>the</span> 
</span><span class='label'><a id='x1-19068r66'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>directory</span></span><span style='color:#000000'> <span class='ecit-1000'>&lt;prefix&gt;, </span><span class='ecit-1000'>and </span><span class='ecit-1000'>the </span><span class='ecit-1000'>output </span><span class='ecit-1000'>(as </span><span class='ecit-1000'>a </span><span class='ecit-1000'>1-iteration</span> 
</span><span class='label'><a id='x1-19069r67'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>decompositions</span></span><span style='color:#000000'><span class='ecit-1000'>)</span></span><span style='color:#000000'> <span class='ecit-1000'>will </span><span class='ecit-1000'>generated </span><span class='ecit-1000'>in </span><span class='ecit-1000'>the </span><span class='ecit-1000'>same </span><span class='ecit-1000'>directory.</span> 
</span><span class='label'><a id='x1-19070r68'></a></span> 
<span class='label'><a id='x1-19071r69'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Input</span></span> 
<span class='label'><a id='x1-19072r70'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>-----</span></span> 
<span class='label'><a id='x1-19073r71'></a></span> 
<span class='label'><a id='x1-19074r72'></a></span><span class='ecit-1000'>            </span><span style='color:#000000'><span class='ecit-1000'>prefix</span></span><span style='color:#000000'> <span class='ecit-1000'>: </span><span class='ecit-1000'>str</span> 
</span><span class='label'><a id='x1-19075r73'></a></span> 
<span class='label'><a id='x1-19076r74'></a></span><span class='ecit-1000'>                </span><span style='color:#000000'><span class='ecit-1000'>Localization</span></span><span style='color:#000000'> <span class='ecit-1000'>of </span><span class='ecit-1000'>the </span><span class='ecit-1000'>input/output </span><span class='ecit-1000'>images. </span><span class='ecit-1000'>Example:</span> 
</span><span class='label'><a id='x1-19077r75'></a></span><span class='ecit-1000'>                </span><span style='color:#000000'><span class='ecit-1000'>"/</span></span><span style='color:#000000'><span class='ecit-1000'>tmp</span></span><span style='color:#000000'><span class='ecit-1000'>/".</span></span> 
<span class='label'><a id='x1-19078r76'></a></span> 
<span class='label'><a id='x1-19079r77'></a></span><span class='ecit-1000'>             </span><span style='color:#000000'><span class='ecit-1000'>N</span></span><span style='color:#000000'> <span class='ecit-1000'>: </span><span class='ecit-1000'>int</span> 
</span><span class='label'><a id='x1-19080r78'></a></span> 
<span class='label'><a id='x1-19081r79'></a></span><span class='ecit-1000'>                </span><span style='color:#000000'><span class='ecit-1000'>Number</span></span><span style='color:#000000'> <span class='ecit-1000'>of </span><span class='ecit-1000'>decompositions </span><span class='ecit-1000'>to </span><span class='ecit-1000'>process.</span> 
</span><span class='label'><a id='x1-19082r80'></a></span> 
<span class='label'><a id='x1-19083r81'></a></span><span class='ecit-1000'>             </span><span style='color:#000000'><span class='ecit-1000'>T</span></span><span style='color:#000000'> <span class='ecit-1000'>: </span><span class='ecit-1000'>int</span> 
</span><span class='label'><a id='x1-19084r82'></a></span> 
<span class='label'><a id='x1-19085r83'></a></span><span class='ecit-1000'>                </span><span style='color:#000000'><span class='ecit-1000'>Number</span></span><span style='color:#000000'> <span class='ecit-1000'>of </span><span class='ecit-1000'>iterations </span><span class='ecit-1000'>of </span><span class='ecit-1000'>the </span><span class='ecit-1000'>MCOLP </span><span class='ecit-1000'>(temporal </span><span class='ecit-1000'>scales).</span> 
</span><span class='label'><a id='x1-19086r84'></a></span> 
<span class='label'><a id='x1-19087r85'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>Returns</span></span> 
<span class='label'><a id='x1-19088r86'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='ecit-1000'>-------</span></span> 
<span class='label'><a id='x1-19089r87'></a></span> 
<span class='label'><a id='x1-19090r88'></a></span><span class='ecit-1000'>            </span><span style='color:#000000'><span class='ecit-1000'>The</span></span><span style='color:#000000'> <span class='ecit-1000'>sequence </span><span class='ecit-1000'>of </span><span class='ecit-1000'>1-iteration </span><span class='ecit-1000'>decompositions.</span> 
</span><span class='label'><a id='x1-19091r89'></a></span> 
<span class='label'><a id='x1-19092r90'></a></span><span class='ecit-1000'>        </span><span style='color:#000000'><span class='tcit-1000'>'''</span></span> 
<span class='label'><a id='x1-19093r91'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>x</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>2**T</span> 
</span><span class='label'><a id='x1-19094r92'></a></span><span class='ectt-1000'>        </span><span style='color:#000000'><span class='ectt-1000'>for</span></span><span style='color:#000000'> <span class='ectt-1000'>t </span><span class='ectt-1000'>in </span><span class='ectt-1000'>range(T): </span><span class='ecit-1000'># </span><span class='ecit-1000'>Temporal </span><span class='ecit-1000'>scale</span> 
</span><span class='label'><a id='x1-19095r93'></a></span><span class='ectt-1000'>            </span><span style='color:#000000'><span class='ectt-1000'>i</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>0</span> 
</span><span class='label'><a id='x1-19096r94'></a></span><span class='ectt-1000'>            </span><span style='color:#000000'><span class='ectt-1000'>aL</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'> <span class='ectt-1000'>aH </span><span class='ectt-1000'>= </span><span class='ectt-1000'>decomposition.read(prefix, </span><span class='ectt-1000'>"{:03d}".format(0))</span> 
</span><span class='label'><a id='x1-19097r95'></a></span><span class='ectt-1000'>            </span><span style='color:#000000'><span class='ectt-1000'>while</span></span><span style='color:#000000'> <span class='ectt-1000'>i </span><span class='ectt-1000'>&lt; </span><span class='ectt-1000'>(N//x):</span> 
</span><span class='label'><a id='x1-19098r96'></a></span><span class='ectt-1000'>                </span><span style='color:#000000'><span class='ectt-1000'>bL</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'> <span class='ectt-1000'>residue_bH </span><span class='ectt-1000'>= </span><span class='ectt-1000'>decomposition.read(prefix, </span><span class='ectt-1000'>"{:03d}".format(x*i+x//2))</span> 
</span><span class='label'><a id='x1-19099r97'></a></span><span class='ectt-1000'>                </span><span style='color:#000000'><span class='ectt-1000'>cL</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'> <span class='ectt-1000'>cH </span><span class='ectt-1000'>= </span><span class='ectt-1000'>decomposition.read(prefix, </span><span class='ectt-1000'>"{:03d}".format(x*i+x))</span> 
</span><span class='label'><a id='x1-19100r98'></a></span><span class='ectt-1000'>                </span><span style='color:#000000'><span class='ectt-1000'>bH</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>self.__backward_butterfly(aL, </span><span class='ectt-1000'>aH, </span><span class='ectt-1000'>bL, </span><span class='ectt-1000'>residue_bH, </span><span class='ectt-1000'>cL, </span><span class='ectt-1000'>cH)</span> 
</span><span class='label'><a id='x1-19101r99'></a></span><span class='ectt-1000'>                </span><span style='color:#000000'><span class='ectt-1000'>decomposition</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>writeH</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>bH</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'> <span class='ectt-1000'>prefix, </span><span class='ectt-1000'>"{:03d}".format(x*i+x//2))</span> 
</span><span class='label'><a id='x1-19102r100'></a></span><span class='ectt-1000'>                </span><span style='color:#000000'><span class='ectt-1000'>aL</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'> <span class='ectt-1000'>aH </span><span class='ectt-1000'>= </span><span class='ectt-1000'>cL, </span><span class='ectt-1000'>cH</span> 
</span><span class='label'><a id='x1-19103r101'></a></span><span class='ectt-1000'>                </span><span style='color:#000000'><span class='ectt-1000'>i</span></span><span style='color:#000000'> <span class='ectt-1000'>+= </span><span class='ectt-1000'>1</span> 
</span><span class='label'><a id='x1-19104r102'></a></span><span class='ectt-1000'>            </span><span style='color:#000000'><span class='ectt-1000'>x</span></span><span style='color:#000000'> <span class='ectt-1000'>//=2</span></span>
</pre>
<a id='x1-19105r6'></a>
<figcaption class='caption'><span class='id'>Figure 6: </span><span class='content'>Implementation of the MCOLP.                               </span></figcaption><!-- tex4ht:label?: x1-19105r6  -->
                                                                  

                                                                  
   </figure>
<!-- l. 693 --><p class='indent'>   Notice that, if the parameter \(N=G+1\) (where \(G\) is the GOP size, see Eq. <a href='#x1-17001r1'>1<!-- tex4ht:ref: eq:GOP_size  --></a>), except for the
first and the last frame of the sequence, all the \(H\)-subbands are compensated.
</p>
   <h4 class='subsectionHead'><span class='titlemark'>9.3   </span> <a id='x1-200009.3'></a>Example: \(\mathtt {MRVC}(T=1, N=5)\)</h4>
<!-- l. 702 --><p class='noindent'>In this example (see Fig. <a href='#x1-20001r7'>7<!-- tex4ht:ref: fig:1xMRVC1  --></a>), a sequence of five frames is transformed first with \(\mathtt {MDWT}(N=5)\),
producing 2 SRLs by frame. Next, the \(H\) subbands of the odd frames (frames 1 and 3)
are motion compensated using \(\mathtt {MCOLP}(T=1, N=5)\).
                                                                  

                                                                  
</p>
   <pre class='verbatim' id='verbatim-10'>
predictor=1
iterations=1

# You must be in the ’src’ directory to run this.
rm -f /tmp/*.png
cp ../sequences/stockholm/*.png /tmp

# 1-iteration MDWT.
python3 -O MDWT.py -p /tmp/

# Show the length of the subbands.
for i in /tmp/LL???.png; do ls -l $i; done
for i in /tmp/LH???.png; do ls -l $i; done
for i in /tmp/HL???.png; do ls -l $i; done
for i in /tmp/HH???.png; do ls -l $i; done

# 1-iteration MCOLP.
python3 -O MCOLP.py -P $predictor -p /tmp/ -T $iterations

# Show the length of the subbands.
for i in /tmp/LL???.png; do ls -l $i; done
for i in /tmp/LH???.png; do ls -l $i; done
for i in /tmp/HL???.png; do ls -l $i; done
for i in /tmp/HH???.png; do ls -l $i; done

# Has changed in length any of them? Remember that a change in lenght
# implies a change in content.

# Lets recover the original sequence ...
rm /tmp/???.png

# 1-iteration iMCOLP.
python3 -O MCOLP.py -P $predictor -b -p /tmp/ -T $iterations

# 1-iteration iMDWT.
python3 -O MDWT.py -b -p /tmp/

# Visualization of the reconstruction.
for i in /tmp/???.png; do python3 ../tools/substract_offset.py -i $i -o $i.png; done
animate /tmp/???.png.png

                                                                  

                                                                  
# Visualization of the residue.
for i in {0..4}; do ii=$(printf "%03d" $i); bash ../tools/show_differences.sh -1 /tmp/$ii.png -2 ../sequences/stockholm/$ii.png -o /tmp/diff_$ii.png; done
animate /tmp/diff*.png
</pre>
<!-- l. 752 --><p class='nopar'>
</p>
   <figure class='figure'> 

                                                                  

                                                                  
                                                                  

                                                                  
<!-- l. 756 --><p class='noindent'><div style='text-align:center;'> <img src='graphics/temporal_decorrelation_1x1.svg' /> </div>  <a id='x1-20001r7'></a>
</p>
<figcaption class='caption'><span class='id'>Figure 7: </span><span class='content'>Subbands generated after running \(\mathtt {MRVC}(T=1, N=5)\): (1) subband \(\{F_i\}.L\), that provides spatial
resolution level \(1\) of the sequence, (2) subband \(\{F_{2i}\}.H\), which provides spatial resolution
level \(0\) for the even frames (temporal resolution level \(1\) at full spatial resolution),
and (3) subband \(\{{\tilde F}_{2i+1}\}.H\), that provides spatial resolution level \(0\) for the odd frames
(temporal resolution level \(0\) at full spatial resolution, considering that \(\{F_{2i}\}.H\) has been
already decoded).                                                   </span></figcaption><!-- tex4ht:label?: x1-20001r7  -->
                                                                  

                                                                  
   </figure>
   <h4 class='subsectionHead'><span class='titlemark'>9.4   </span> <a id='x1-210009.4'></a>Example: \(\mathtt {MRVC}(T=2, N=5)\)</h4>
<!-- l. 774 --><p class='noindent'>This example is similar to the previous, but now the number of iterations of MCOLP
is \(T=2\), and therefore, the second iteration of MCOLP compensates also the \(H\) subband
of the frame 2. This example matches exactly with the described in the
Fig. <a href='#x1-21001r8'>8<!-- tex4ht:ref: fig:1xMRVC2  --></a>. Notice that the GOP size is \(4\) (\(3\) TRLs) and the number of SRLs is
\(2\).
                                                                  

                                                                  
</p>
   <pre class='verbatim' id='verbatim-11'>
predictor=1

# You must be in the ’src’ directory.
rm /tmp/*.png
cp ../sequences/stockholm/*.png /tmp

# 1D 1-iteration MDWT.
python3 -O MDWT.py -p /tmp/

# Save a copy of the MDWT subbands (for comparing later).
rm -rf /tmp/tmp
mkdir /tmp/tmp
cp /tmp/*.png /tmp/tmp

# 1-iteration MCOLP.
python3 -O MCOLP.py -p /tmp/ -T 1

# Is the content of the MCOLP subbands different to the MDWT’s output?
for i in {0..4}; do ii=$(printf "%03d" $i); ls -l /tmp/LL$ii.png /tmp/tmp/LL$ii.png;echo; done
for i in {0..4}; do ii=$(printf "%03d" $i); ls -l /tmp/LH$ii.png /tmp/tmp/LH$ii.png;echo; done
for i in {0..4}; do ii=$(printf "%03d" $i); ls -l /tmp/HL$ii.png /tmp/tmp/HL$ii.png;echo; done
for i in {0..4}; do ii=$(printf "%03d" $i); ls -l /tmp/HH$ii.png /tmp/tmp/HH$ii.png;echo; done

rm /tmp/*.png
cp ../sequences/stockholm/*.png /tmp

# 1D 1-iteration MDWT.
python3 -O MDWT.py -p /tmp/

# Save a copy of the MDWT subbands (for comparing later).
rm -rf /tmp/tmp
mkdir /tmp/tmp
cp /tmp/*.png /tmp/tmp

# 2-iterations MCOLP.
python3 -O MCOLP.py -p /tmp/ -T 2

# Is the content of the MCOLP subbands different to the MDWT’s output?
for i in {0..4}; do ii=$(printf "%03d" $i); ls -l /tmp/LL$ii.png /tmp/tmp/LL$ii.png;echo; done
for i in {0..4}; do ii=$(printf "%03d" $i); ls -l /tmp/LH$ii.png /tmp/tmp/LH$ii.png;echo; done
for i in {0..4}; do ii=$(printf "%03d" $i); ls -l /tmp/HL$ii.png /tmp/tmp/HL$ii.png;echo; done
                                                                  

                                                                  
for i in {0..4}; do ii=$(printf "%03d" $i); ls -l /tmp/HH$ii.png /tmp/tmp/HH$ii.png;echo; done

# Comparing LH visually.
for i in {0..4}; do ii=$(printf "%03d" $i); convert -normalize /tmp/tmp/LH$ii.png /tmp/tmp/MDWT_LH$ii.png; done
for i in {0..4}; do ii=$(printf "%03d" $i); convert -normalize /tmp/LH$ii.png /tmp/MCOLP_LH$ii.png; done
animate /tmp/tmp/MDWT_LH00?.png &amp;
animate /tmp/MCOLP_LH00?.png &amp;

# Comparing LH002 numerically.
echo MDWT &gt; /tmp/1
printf "%61s\n" MCOLP &gt; /tmp/2
python3 ../tools/show_statistics.py -i /tmp/tmp/LH002.png &gt;&gt; /tmp/1
python3 ../tools/show_statistics.py -i /tmp/LH002.png &gt;&gt; /tmp/2
paste /tmp/1 /tmp/2

# Comparing HL visually.
for i in {0..4}; do ii=$(printf "%03d" $i); convert -normalize /tmp/tmp/HL$ii.png /tmp/tmp/MDWT_HL$ii.png; done
for i in {0..4}; do ii=$(printf "%03d" $i); convert -normalize /tmp/HL$ii.png /tmp/MCOLP_HL$ii.png; done
animate /tmp/tmp/MDWT_HL00?.png &amp;
animate /tmp/MCOLP_HL00?.png &amp;

# Comparing HL002 numerically.
echo MDWT &gt; /tmp/1
printf "%61s\n" MCOLP &gt; /tmp/2
python3 ../tools/show_statistics.py -i /tmp/tmp/HL002.png &gt;&gt; /tmp/1
python3 ../tools/show_statistics.py -i /tmp/HL002.png &gt;&gt; /tmp/2
paste /tmp/1 /tmp/2

# Comparing HH visually.
for i in {0..4}; do ii=$(printf "%03d" $i); convert -normalize /tmp/tmp/HH$ii.png /tmp/tmp/MDWT_HH$ii.png; done
for i in {0..4}; do ii=$(printf "%03d" $i); convert -normalize /tmp/HH$ii.png /tmp/MCOLP_HH$ii.png; done
animate /tmp/tmp/MDWT_HH00?.png &amp;
animate /tmp/MCOLP_HH00?.png &amp;

# Comparing HH002 numerically.
echo MDWT &gt; /tmp/1
printf "%61s\n" MCOLP &gt; /tmp/2
python3 ../tools/show_statistics.py -i /tmp/tmp/HH002.png &gt;&gt; /tmp/1
python3 ../tools/show_statistics.py -i /tmp/HH002.png &gt;&gt; /tmp/2
paste /tmp/1 /tmp/2

# Now we recover the original video.

# 2-iterations iMCOLP.
python3 -O MCOLP.py -P $predictor -b -p /tmp/ -T $iterations

                                                                  

                                                                  
# 1-iteration iMDWT
python3 -O MDWT.py -b -p /tmp/

# Visualization of the reconstruction.
for i in /tmp/???.png; do python3 ../tools/substract_offset.py -i $i -o $i.png; done
animate /tmp/???.png.png

# Visualization of the residue.
for i in {0..4}; do ii=$(printf "%03d" $i); bash ../tools/show_differences.sh -1 /tmp/$ii.png -2 ../sequences/stockholm/$ii.png -o /tmp/diff_$ii.png; done
animate /tmp/diff*.png

python3 ../tools/show_statistics.py -i /tmp/diff_002.png
</pre>
<!-- l. 881 --><p class='nopar'>
</p>
   <figure class='figure'> 

                                                                  

                                                                  
                                                                  

                                                                  
<!-- l. 885 --><p class='noindent'><div style='text-align:center;'> <img src='graphics/temporal_decorrelation_1x2.svg' /> </div>  <a id='x1-21001r8'></a>
</p>
<figcaption class='caption'><span class='id'>Figure 8: </span><span class='content'>Subbands generated after running \(\mathtt {MRVC}(T=2, N=5)\): (1) subband \(\{F_i\}.L\), that provides spatial
resolution level \(1\) of the sequence, (2) \(\{F_{2^2i}\}.H\), which provides spatial resolution level \(0\)
for frames with number \(2^2i\) (temporal resolution level \(2\) at full spatial resolution),
(3) subband \(\{{\tilde F}_{2^2i+2}\}.H\), that provides spatial resolution level \(0\) for the frames with number
\(2^2i+2\) (that  considering  also  \(\{F_{2^2i}\}.H\),  provides  temporal  resolution  level  \(1\)  at  full  spatial
resolution), and finally (4) subband \(\{{\tilde F}_{2i+1}\}.H\), which provides spatial resolution level \(0\) for
odd images (temporal resolution level \(0\) at full spatial resolution, considering the
previouly decoded temporal resolution levels).                           </span></figcaption><!-- tex4ht:label?: x1-21001r8  -->
                                                                  

                                                                  
   </figure>
   <h4 class='subsectionHead'><span class='titlemark'>9.5   </span> <a id='x1-220009.5'></a>Simplification of the notation</h4>
<!-- l. 907 --><p class='noindent'>For the sake of simplifying the notation, we will represent \(\{F_t\}.L^s\) by \(L_t^s\), and \(\{F_t\}.H^s\) by \(H_t^s\). Thus,
for example, the subbands shown in the Fig. <a href='#x1-21001r8'>8<!-- tex4ht:ref: fig:1xMRVC2  --></a> can be represented as: (1) \(L\)
(that is a version of the sequence with spatial resolution \(X/2\times Y/2\)), (2) \(H_{2^2i}\) (made up of
intra-coded high-frequency spatial information of the frames with numbers
\(2^2i\)), (3) \(\tilde {H}_{2^2i+2}\) (with the high-frequency spatio-temporal prediction error resulting
from decorrelating even frames with distance \(2^2\)), and (4) \(\tilde {H}_{2i+1}\) (high-frequency
spatio-temporal prediction error resulting from decorrelating frames with distance
\(2\)).
</p><!-- l. 921 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>9.6   </span> <a id='x1-230009.6'></a>Example: \(\mathtt {MRVC}(T=4, N=17)\)</h4>
<!-- l. 924 --><p class='noindent'>An example with \(G=2^4=16\), i.e. \(5\) TRLs and \(2\) SRLs. The subbands generated are:
     </p><ol class='enumerate1'>
<li class='enumerate' id='x1-23002x1'>\(L\), that by itself, allows to reconstruct all the frames at half resolution.
     </li>
<li class='enumerate' id='x1-23004x2'>\(H_{16i+8}\), which with \(L\), provides full resolution for frames with number \(16i+8\) (the rest
     of frames have half resolution).
     </li>
<li class='enumerate' id='x1-23006x3'>\(H_{8i+4}\), that with the previous subbands provides full resolution also for frames
     with number \(8i+4\).
     </li>
<li class='enumerate' id='x1-23008x4'>\(H_{4i+2}\), which also provides full resolution for frames \(4i+2\).
     </li>
<li class='enumerate' id='x1-23010x5'>\(H_{2i+1}\), that reconstruct the original sequence.</li></ol>
                                                                  

                                                                  
<!-- l. 937 --><p class='indent'>   The temporal decorrelation pattern followed by \(\mathtt {iMCOLP(T=4, N=17)}\) is (notice that the hexadecimal
notation has been followed for indexing the frames) shown in the Fig. <a href='#x1-23011r9'>9<!-- tex4ht:ref: fig:MRVC_4_17  --></a>.
</p>
   <figure class='figure'> 

                                                                  

                                                                  
                                                                  

                                                                  
<pre class='verbatim' id='verbatim-12'>
GOP0                     GOP1
---- ------------------------------------------------
  F0                      F8                      F10 -&gt; H_{8i }  (= TRL3)
              F4                      Fc              -&gt; H_{8i+4} (+ TRL3 = TRL2)
        F2          F6          Fa          Fe        -&gt; H_{4i+2} (+ TRL2 = TRL1)
     F1    F3    F5    F7    F9    Fb    Fd    Ff     -&gt; H_{2i+1} (+ TRL1 = TRL0)
</pre>
<!-- l. 949 --><p class='nopar'> <a id='x1-23011r9'></a>
</p>
<figcaption class='caption'><span class='id'>Figure 9: </span><span class='content'>Motion compensation pattern followed by \(\mathtt {MCOLP(T=4, N=17)}\). The temporal resolution
levels (TRLs) are considering only the frames that has been reconstructed at
the original spatial resolution.
</span></figcaption><!-- tex4ht:label?: x1-23011r9  -->
                                                                  

                                                                  
   </figure>
                                                                  

                                                                  
   <pre class='verbatim' id='verbatim-13'>
# You must be in the ’src’ directory.
rm /tmp/*.png
video_file=/tmp/akiyo_cif.y4m
if test -f $video_file; then
  print akiyo exists
else
  wget https://media.xiph.org/video/derf/y4m/akiyo_cif.y4m -O /tmp/akiyo_cif.y4m
fi
mplayer /tmp/akiyo_cif.y4m
ffmpeg -i /tmp/akiyo_cif.y4m -vframes 17 -start_number 0 /tmp/%03d.png

# 1D 1-iteration MDWT.
python3 -O MDWT.py -p /tmp/ -N 17

# Save a copy of the MDWT subbands (for comparing later).
rm -rf /tmp/tmp
mkdir /tmp/tmp
cp /tmp/LL*.png /tmp/tmp
cp /tmp/LH*.png /tmp/tmp
cp /tmp/HL*.png /tmp/tmp
cp /tmp/HH*.png /tmp/tmp

# 4-iterations MCOLP.
python3 -O MCOLP.py -p /tmp/ -T 4 -N 17

ls -l /tmp/LH*.png &gt; /tmp/1
ls -l /tmp/tmp/LH*.png &gt; /tmp/2
paste /tmp/1 /tmp/2

ls -l /tmp/HL*.png &gt; /tmp/1
ls -l /tmp/tmp/HL*.png &gt; /tmp/2
paste /tmp/1 /tmp/2

ls -l /tmp/HH*.png &gt; /tmp/1
ls -l /tmp/tmp/HH*.png &gt; /tmp/2
paste /tmp/1 /tmp/2

# Now we recover the original video.

# 4-iterations iMCOLP.
python3 -O MCOLP.py -b -p /tmp/ -T 4 -N 17

                                                                  

                                                                  
# 1-iteration iMDWT
python3 -O MDWT.py -b -p /tmp/ -N 17

# Visualization of the reconstruction.
for i in /tmp/???.png; do python3 ../tools/substract_offset.py -i $i -o $i.png; done
animate /tmp/???.png.png

# Visualization of the residue.
for i in {0..16}; do ii=$(printf "%03d" $i); bash ../tools/show_differences.sh -1 /tmp/$ii.png -2 ../sequences/stockholm/$ii.png -o /tmp/diff_$ii.png; done
animate /tmp/diff*.png

python3 ../tools/show_statistics.py -i /tmp/diff_002.png
</pre>
<!-- l. 1012 --><p class='nopar'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>9.7   </span> <a id='x1-240009.7'></a>Scalability provided by MCOLP</h4>
<!-- l. 1019 --><p class='noindent'>MCOLP preserves the dyadic spatial decomposition generated by MDWT, and
therefore, MCOLP provides the same spatial scalability than MDWT.
</p><!-- l. 1022 --><p class='indent'>   Unfortunately, as the rest of video encoders based on MC, MCOLP reduces the
temporal scalability provided by MDWT, allowing (in the case of MCOLP) only a
dyadic access to the frames.
</p><!-- l. 1028 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>9.8   </span> <a id='x1-250009.8'></a>Example: 3-iters of \(\mathtt {MRVC}(T=2, N=5)\)</h4>
                                                                  

                                                                  
   <pre class='verbatim' id='verbatim-14'>
predictor=1
iterations=2

# You must be in the ’src’ directory.
rm /tmp/*.png
cp ../sequences/stockholm/* /tmp

python3 -O MDWT.py  -p /tmp/
python3 -O MCOLP.py -p /tmp/     -P $predictor -T $iterations
python3 -O MDWT.py  -p /tmp/LL
python3 -O MCOLP.py -p /tmp/LL   -P $predictor -T $iterations
python3 -O MDWT.py  -p /tmp/LLLL
python3 -O MCOLP.py -p /tmp/LLLL -P $predictor -T $iterations

rm /tmp/00?.png

python3 -O MCOLP.py -p /tmp/LLLL -P $predictor -b -T $iterations
python3 -O MDWT.py  -p /tmp/LLLL               -b
python3 -O MCOLP.py -p /tmp/LL   -P $predictor -b -T $iterations
python3 -O MDWT.py  -p /tmp/LL                 -b
python3 -O MCOLP.py -p /tmp/     -P $predictor -b -T $iterations
python3 -O MDWT.py  -p /tmp/                   -b

for i in /tmp/00?.png; do python ../tools/substract_offset.py -i $i -o $i.png; done; animate /tmp/00?.png.png

for i in {0..4}; do ii=$(printf "%03d" $i); bash ../tools/show_differences.sh -1 /tmp/$ii.png -2 ../sequences/stockholm/$ii.png -o /tmp/diff_$ii.png; done
animate /tmp/diff*.png
</pre>
<!-- l. 1059 --><p class='nopar'>
</p><!-- l. 1061 --><p class='indent'>   In this case, \(G=4\), generating \(3\) TRLs (see Fig. <a href='#x1-25001r10'>10<!-- tex4ht:ref: fig:MRVC_2_5_T  --></a>), and \(4\) is the number of SRLs (see
Fig. <a href='#x1-25002r11'>11<!-- tex4ht:ref: fig:MRVC_2_5_S  --></a>).
</p>
   <figure class='figure'> 

                                                                  

                                                                  
                                                                  

                                                                  
<pre class='verbatim' id='verbatim-15'>

TRLs:

GOP0     GOP1
---- ------------
  F0           F4  -&gt; H_{4i} (= TRL2)
         F2        -&gt; H_{4i+2} (+ TRL2 = TRL1)
      F1    F3     -&gt; H_{2i+1} (+ TRL1 = TRL0)
</pre>
<!-- l. 1075 --><p class='nopar'> <a id='x1-25001r10'></a>
</p>
<figcaption class='caption'><span class='id'>Figure 10: </span><span class='content'>Motion compensation pattern followed by \(\mathtt {MCOLP(T=2, N=5)}\). The TRLs consider only
the frames that has been reconstructed at the original spatial resolution.
</span></figcaption><!-- tex4ht:label?: x1-25001r10  -->
                                                                  

                                                                  
   </figure>
   <figure class='figure'> 

                                                                  

                                                                  
                                                                  

                                                                  
<pre class='verbatim' id='verbatim-16'>

+---+---+-------+---------------+
| 3 | 2 |   1   |       0       |
+---+   |       |               |
|       |       |               |
+-------+       |               |
|               |               |
|               |               |
|               |               |
+---------------+               |
|                               |
|                               |
|                               |
|                               |
|                               |
|                               |
|                               |
|                               |
|                               |
|                               |
+-------------------------------+
</pre>
<!-- l. 1105 --><p class='nopar'> <a id='x1-25002r11'></a>
</p>
<figcaption class='caption'><span class='id'>Figure 11: </span><span class='content'>SRLs generated by \(3\) iterations of \(\mathtt {MRVC}\). \(0\) corresponds with the original
resolution of the frames.
</span></figcaption><!-- tex4ht:label?: x1-25002r11  -->
                                                                  

                                                                  
   </figure>
   <h3 class='sectionHead'><span class='titlemark'>10   </span> <a id='x1-2600010'></a>Adaptive motion compensation based on the energy of the estimated
prediction error</h3>
<!-- l. 1116 --><p class='noindent'>As can be seen in the MCOLP bufferfly (see Fig. <a href='#x1-18073r5'>5<!-- tex4ht:ref: fig:forward_butterfly  --></a>), both predictions \([b_a.H]\) and \([b_c.H]\) weight
the same in the prediction \begin {equation}  [\hat {b.H}] = \frac {[b_a.H] + [b_c.H]}{2}.  \end {equation}<a id='x1-26001r2'></a> This simple computation, that can have very effective for
example in <a href='https://biteable.com/blog/tips/video-transitions-effects-examples/'>dissolves</a> video transitions, can also be counterproductive when objects
appear only in one of the reference frames. For this reason, in this section an
improved predictor is proposed, based on the estimated prediction error (see \([\tilde {b}.H]\) in the
Fig. <a href='#x1-18073r5'>5<!-- tex4ht:ref: fig:forward_butterfly  --></a>) generated throughout the ME/MC. To estimate this error, we will suppose
that the prediction error generated for the high frequencies of an frame is
correlated with the prediction error generated for the low frequencies of such
frame.
</p><!-- l. 1133 --><p class='indent'>   Let \([b_a.L]\) the prediction generated for the subband \([b.L]\) using \([a.L]\) as reference and \([a.L]\rightarrow [b.L]\) as motion,
and let \([b_c.L]\) the prediction generated for \([b.L]\) using \([c.L]\) as reference and \([c.L]\rightarrow [b.L]\) as motion. We now
compute the prediction errors \begin {equation}  \begin {array}{l} {[e_a.L]} = [b.L] - [b_a.L]\\ {[e_c.L]} = [b.L] - [b_c.L]. \end {array}  \end {equation}<a id='x1-26002r3'></a>
</p><!-- l. 1145 --><p class='indent'>   We define <span class='ecti-1000'>similarity matrices </span>as \begin {equation}  \begin {array}{l} {[s_a.L]} = \frac {1}{1+{|[e_a.L]|}}\\ {[s_c.L]} = \frac {1}{1+{|[e_c.L]|}}. \end {array} \label {eq:weighted_prediction}  \end {equation}<a id='x1-26003r4'></a> Notice that, if (for example) the error \([e_a.L]_{x,y}=0\), the
similarity is \([s_a.L]_{x,y}=1\) (the maximum similarity). On the other side, if the error is high, the
similarity tends to be low (but never \(0\)).
</p><!-- l. 1158 --><p class='indent'>   With this information, that can be recovered by the decoder, the improved
prediction is defined as \begin {equation}  [\hat {b.H}] = \frac {[b_a.H][s_a.L]+[s_c.L][b_c.H]}{[s_a.L]+[s_c.L]}.  \end {equation}<a id='x1-26004r5'></a> The Fig. <a href='#x1-26019r12'>12<!-- tex4ht:ref: fig:weighted_average  --></a> shows an implementation of this equation.
</p><!-- l. 1166 --><p class='indent'>   Notice that, if (for example) \([s_a.L]_{x,y}=1\) and \([s_c.L]_{x,y}\approx 0\), then \([\hat {b.H}]_{x,y} \approx [b_a.H]_{x,y}\), and viceversa. If \([s_a.L]_{x,y}=[s_c.L]_{x,y}\), then \([\hat {b.H}]_{x,y}=\frac {[b_a.H]_{x,y}+[b_c.H]_{x,y}}{2}\) (even if both
similarities are small).
</p>
   <figure class='figure'> 

                                                                  

                                                                  
                                                                  

                                                                  
<!-- l. 1174 --><pre class='lstinputlisting' id='listing-6'><span class='label'><a id='x1-26007r1'></a></span><span style='color:#000000'><span class='ectt-1000'> ef</span></span><span style='color:#000000'> <span class='ectt-1000'>generate_prediction(AL, </span><span class='ectt-1000'>BL, </span><span class='ectt-1000'>CL, </span><span class='ectt-1000'>AH, </span><span class='ectt-1000'>CH):</span> 
</span><span class='label'><a id='x1-26008r2'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>flow_AL_BL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>motion_estimation(AL, </span><span class='ectt-1000'>BL)</span> 
</span><span class='label'><a id='x1-26009r3'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>flow_CL_BL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>motion_estimation(CL, </span><span class='ectt-1000'>BL)</span> 
</span><span class='label'><a id='x1-26010r4'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>BAH</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>estimate_frame(AH, </span><span class='ectt-1000'>flow_AL_BL)</span> 
</span><span class='label'><a id='x1-26011r5'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>BCH</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>estimate_frame(CH, </span><span class='ectt-1000'>flow_CL_BL)</span> 
</span><span class='label'><a id='x1-26012r6'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>BAL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>estimate_frame(AL, </span><span class='ectt-1000'>flow_AL_BL)</span> 
</span><span class='label'><a id='x1-26013r7'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>BCL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>estimate_frame(CL, </span><span class='ectt-1000'>flow_CL_BL)</span> 
</span><span class='label'><a id='x1-26014r8'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>EAL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>BL </span><span class='ectt-1000'>- </span><span class='ectt-1000'>BAL</span> 
</span><span class='label'><a id='x1-26015r9'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>ECL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>BL </span><span class='ectt-1000'>- </span><span class='ectt-1000'>BCL</span> 
</span><span class='label'><a id='x1-26016r10'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>SAL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>1/(1+abs(EAL))</span> 
</span><span class='label'><a id='x1-26017r11'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>SCL</span></span><span style='color:#000000'> <span class='ectt-1000'>= </span><span class='ectt-1000'>1/(1+abs(ECL))</span> 
</span><span class='label'><a id='x1-26018r12'></a></span><span class='ectt-1000'>    </span><span style='color:#000000'><span class='ectt-1000'>return</span></span><span style='color:#000000'> <span class='ectt-1000'>(BAH*SAL+BCH*SCL)/(SAL+SCL)</span></span>
</pre>
<a id='x1-26019r12'></a>
<figcaption class='caption'><span class='id'>Figure 12: </span><span class='content'>Computation of the weighted average prediction.                </span></figcaption><!-- tex4ht:label?: x1-26019r12  -->
                                                                  

                                                                  
   </figure>
   <h3 class='sectionHead'><span class='titlemark'>11   </span> <a id='x1-2700011'></a>Lossy compression: quantization</h3>
<!-- l. 1184 --><p class='noindent'><a href='https://vicente-gonzalez-ruiz.github.io/quantization/'>Quantization</a> allows to remove information from signals. We will use it in MCOLP
to achieve higher compression ratios, but at the expense of losing visual
information (ideally, the less relevant information for the <a href='https://vicente-gonzalez-ruiz.github.io/human_visual_system/'>HVS</a> should be removed
first).
</p><!-- l. 1190 --><p class='indent'>   When the signal cannot be recoverd perfectly, we can use a <a href='https://vicente-gonzalez-ruiz.github.io/distortion_metrics/'>distortion metric</a> to
find how much error has been generated.
</p><!-- l. 1196 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>11.1   </span> <a id='x1-2800011.1'></a>Example: Effects caused by the total attenuation of the motion
compensated (MCed) \(H\) subbands</h4>
                                                                  

                                                                  
   <pre class='verbatim' id='verbatim-17'>
predictor=2

# You must be in the ’src’ directory.
rm /tmp/*.png
cp ../sequences/stockholm/*.png /tmp


# 1D 1-iteration MDWT.
python3 -O MDWT.py -p /tmp/

# 1D 1-iteration MCOLP.
python3 -O MCOLP.py -p /tmp/

# Let’s delete the motion compensated subbands and reconstruct the sequence ...
rm -f /tmp/LH001.png
rm -f /tmp/HL001.png
rm -f /tmp/HH001.png
rm -f /tmp/LH002.png
rm -f /tmp/HL002.png
rm -f /tmp/HH002.png
rm -f /tmp/LH003.png
rm -f /tmp/HL003.png
rm -f /tmp/HH003.png

# 1D 1-iteration iMCOLP.
python3 -O MCOLP.py -P $predictor -b -p /tmp/

# 1D 1-iteration iMDWT.
python3 -O MDWT.py -b -p /tmp/

# Visualization of the reconstruction.
for i in /tmp/00?.png; do python3 ../tools/substract_offset.py -i $i -o $i.png; done; animate /tmp/00?.png.png

# Visualization of the differences with the original sequence.
rm -f /tmp/diff*.png; for i in {0..4}; do ii=$(printf "%03d" $i); bash ../tools/show_differences.sh -1 /tmp/$ii.png -2 ../sequences/stockholm/$ii.png -o /tmp/diff_$ii.png; done; animate /tmp/diff*.png

# MSE per frame
for i in {0..4}; do ii=$(printf "%03d" $i); MSE=‘python3 -O ../tools/MSE.py -x ../sequences/stockholm/$ii.png -y /tmp/$ii.png‘; printf "MSE(%s)=%s\n" $ii $MSE; done

# PSNR per frame
for i in {0..4}; do ii=$(printf "%03d" $i); PSNR=‘python3 -O ../tools/PSNR.py -x ../sequences/stockholm/$ii.png -y /tmp/$ii.png‘; printf "PSNR(%s)=%s\n" $ii $PSNR; done
</pre>
<!-- l. 1241 --><p class='nopar'>
                                                                  

                                                                  
</p><!-- l. 1245 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>11.2   </span> <a id='x1-2900011.2'></a>Example: Effects caused by the quantization of MCed \(H\) subbands</h4>
                                                                  

                                                                  
   <pre class='verbatim' id='verbatim-18'>
q_step=32
predictor=2

# You must be in the ’src’ directory.
rm /tmp/*.png
cp ../sequences/stockholm/* /tmp

python3 -O MDWT.py -p /tmp/
python3 -O MCOLP.py -P $predictor -p /tmp/

#python3 ../tools/show_statistics.py -i /tmp/LH001.png
python3 ../tools/quantize.py -i /tmp/LH001.png -o /tmp/LH001.png -q $q_step
#python3 ../tools/show_statistics.py -i /tmp/LH001.png
python3 ../tools/quantize.py -i /tmp/HL001.png -o /tmp/HL001.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HH001.png -o /tmp/HH001.png -q $q_step

python3 ../tools/quantize.py -i /tmp/LH002.png -o /tmp/LH002.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HL002.png -o /tmp/HL002.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HH002.png -o /tmp/HH002.png -q $q_step

python3 ../tools/quantize.py -i /tmp/LH003.png -o /tmp/LH003.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HL003.png -o /tmp/HL003.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HH003.png -o /tmp/HH003.png -q $q_step

python3 -O MCOLP.py -P $predictor -p /tmp/ -b
python3 -O MDWT.py -p /tmp/ -b

for i in /tmp/00?.png; do python3 ../tools/substract_offset.py -i $i -o $i.png; done; animate /tmp/00?.png.png

rm -f /tmp/diff*.png; for i in {0..4}; do ii=$(printf "%03d" $i); bash ../tools/show_differences.sh -1 /tmp/$ii.png -2 ../sequences/stockholm/$ii.png -o /tmp/diff_$ii.png; done; animate /tmp/diff*.png

for i in {0..4}; do ii=$(printf "%03d" $i); MSE=‘python3 -O ../tools/MSE.py -x ../sequences/stockholm/$ii.png -y /tmp/$ii.png‘; printf "MSE(%s)=%s\n" $ii $MSE; done
</pre>
<!-- l. 1281 --><p class='nopar'>
</p><!-- l. 1285 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>11.3   </span> <a id='x1-3000011.3'></a>Example: Quantization of all \(H\) subbands (MCed and intra)</h4>
                                                                  

                                                                  
   <pre class='verbatim' id='verbatim-19'>
q_step=32
predictor=2

# You must be in the ’src’ directory.
rm /tmp/*.png
cp ../sequences/stockholm/* /tmp

python3 -O MDWT.py -p /tmp/
python3 -O MCOLP.py -P $predictor -p /tmp/

python3 ../tools/quantize.py -i /tmp/LH000.png -o /tmp/LH000.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HL000.png -o /tmp/HL000.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HH000.png -o /tmp/HH000.png -q $q_step

python3 ../tools/quantize.py -i /tmp/LH001.png -o /tmp/LH001.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HL001.png -o /tmp/HL001.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HH001.png -o /tmp/HH001.png -q $q_step

python3 ../tools/quantize.py -i /tmp/LH002.png -o /tmp/LH002.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HL002.png -o /tmp/HL002.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HH002.png -o /tmp/HH002.png -q $q_step

python3 ../tools/quantize.py -i /tmp/LH003.png -o /tmp/LH003.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HL003.png -o /tmp/HL003.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HH003.png -o /tmp/HH003.png -q $q_step

python3 ../tools/quantize.py -i /tmp/LH004.png -o /tmp/LH004.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HL004.png -o /tmp/HL004.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HH004.png -o /tmp/HH004.png -q $q_step

python3 -O MCOLP.py -P $predictor -p /tmp/ -b
python3 -O MDWT.py -p /tmp/ -b

for i in /tmp/00?.png; do python3 ../tools/substract_offset.py -i $i -o $i.png; done; animate /tmp/00?.png.png

rm -f /tmp/diff*.png; for i in {0..4}; do ii=$(printf "%03d" $i); bash ../tools/show_differences.sh -1 /tmp/$ii.png -2 ../sequences/stockholm/$ii.png -o /tmp/diff_$ii.png; done; animate /tmp/diff*.png

for i in {0..4}; do ii=$(printf "%03d" $i); MSE=‘python3 -O ../tools/MSE.py -x ../sequences/stockholm/$ii.png -y /tmp/$ii.png‘; printf "MSE(%s)=%s\n" $ii $MSE; done
</pre>
<!-- l. 1327 --><p class='nopar'>
</p><!-- l. 1331 --><p class='noindent'>
                                                                  

                                                                  
</p>
   <h4 class='subsectionHead'><span class='titlemark'>11.4   </span> <a id='x1-3100011.4'></a>Example: Quantization of all subbands</h4>
                                                                  

                                                                  
   <pre class='verbatim' id='verbatim-20'>
q_step=128
predictor=2

# You must be in the ’src’ directory.
rm /tmp/*.png
cp ../sequences/stockholm/* /tmp

python3 -O MDWT.py -p /tmp/
python3 -O MCOLP.py -P $predictor -p /tmp/

python3 ../tools/quantize.py -i /tmp/LL000.png -o /tmp/LL000.png -q $q_step
python3 ../tools/quantize.py -i /tmp/LH000.png -o /tmp/LH000.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HL000.png -o /tmp/HL000.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HH000.png -o /tmp/HH000.png -q $q_step

python3 ../tools/quantize.py -i /tmp/LL001.png -o /tmp/LL001.png -q $q_step
python3 ../tools/quantize.py -i /tmp/LH001.png -o /tmp/LH001.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HL001.png -o /tmp/HL001.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HH001.png -o /tmp/HH001.png -q $q_step

python3 ../tools/quantize.py -i /tmp/LL002.png -o /tmp/LL002.png -q $q_step
python3 ../tools/quantize.py -i /tmp/LH002.png -o /tmp/LH002.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HL002.png -o /tmp/HL002.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HH002.png -o /tmp/HH002.png -q $q_step

python3 ../tools/quantize.py -i /tmp/LL003.png -o /tmp/LL003.png -q $q_step
python3 ../tools/quantize.py -i /tmp/LH003.png -o /tmp/LH003.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HL003.png -o /tmp/HL003.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HH003.png -o /tmp/HH003.png -q $q_step

python3 ../tools/quantize.py -i /tmp/LL004.png -o /tmp/LL004.png -q $q_step
python3 ../tools/quantize.py -i /tmp/LH004.png -o /tmp/LH004.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HL004.png -o /tmp/HL004.png -q $q_step
python3 ../tools/quantize.py -i /tmp/HH004.png -o /tmp/HH004.png -q $q_step

python3 -O MCOLP.py -P $predictor -p /tmp/ -b
python3 -O MDWT.py -p /tmp/ -b

for i in /tmp/00?.png; do python3 ../tools/substract_offset.py -i $i -o $i.png; done; animate /tmp/00?.png.png

rm -f /tmp/diff*.png; for i in {0..4}; do ii=$(printf "%03d" $i); bash ../tools/show_differences.sh -1 /tmp/$ii.png -2 ../sequences/stockholm/$ii.png -o /tmp/diff_$ii.png; done; animate /tmp/diff*.png

                                                                  

                                                                  
for i in {0..4}; do ii=$(printf "%03d" $i); MSE=‘python3 -O ../tools/MSE.py -x ../sequences/stockholm/$ii.png -y /tmp/$ii.png‘; printf "MSE(%s)=%s\n" $ii $MSE; done
</pre>
<!-- l. 1378 --><p class='nopar'>
</p>
   <div class='footnotes'><a id='x1-3002x1'></a>
<!-- l. 56 --><p class='indent'>   <span class='footnote-mark'><a href='#fn1x0-bk' id='fn1x0'><sup class='textsuperscript'>1</sup></a></span><span class='ecrm-0800'>Also called frames, which from a pure mathematical point of view are matrices of</span>
<a href='https://en.wikipedia.org/wiki/Pixel'><span class='ecrm-0800'>pixels</span></a><span class='ecrm-0800'>.</span></p><a id='x1-4002x2'></a>
<!-- l. 97 --><p class='indent'>     <span class='footnote-mark'><a href='#fn2x0-bk' id='fn2x0'><sup class='textsuperscript'>2</sup></a></span><span class='ecrm-0800'>In this document, we will use the term DWT to refeer to the 2D-DWT.</span></p><a id='x1-4004x2'></a>
<!-- l. 105 --><p class='indent'>     <span class='footnote-mark'><a href='#fn3x0-bk' id='fn3x0'><sup class='textsuperscript'>3</sup></a></span><span class='ecrm-0800'>The structure that forms the subbands is called also a decomposition.</span></p><a id='x1-4006x2'></a>
<!-- l. 112 --><p class='indent'>     <span class='footnote-mark'><a href='#fn4x0-bk' id='fn4x0'><sup class='textsuperscript'>4</sup></a></span><span class='ecrm-0800'>This operation is also called “decimation” and “subsampling”.</span></p><a id='x1-4008x2'></a>
<!-- l. 132 --><p class='indent'>     <span class='footnote-mark'><a href='#fn5x0-bk' id='fn5x0'><sup class='textsuperscript'>5</sup></a></span><span class='ecrm-0800'>This affects to the idependency of the coefficients in terms of energy contribution to the
</span><span class='ecrm-0800'>reconstruction of the signal.</span></p><a id='x1-6002x3'></a>
<!-- l. 175 --><p class='indent'>     <span class='footnote-mark'><a href='#fn6x0-bk' id='fn6x0'><sup class='textsuperscript'>6</sup></a></span><span class='ecrm-0800'>Notice that </span><a href='https://pywavelets.readthedocs.io/en/latest/index.html'><span class='ecrm-0800'>PyWavelets</span></a> <span class='ecrm-0800'>uses the term “levels” for refering to the number of iterations of the
</span><span class='ecrm-0800'>1-level DWT.</span></p><a id='x1-14002x6.3'></a>
<!-- l. 469 --><p class='indent'>     <span class='footnote-mark'><a href='#fn7x0-bk' id='fn7x0'><sup class='textsuperscript'>7</sup></a></span><span class='ecrm-0800'>In video coding, images are commonly refered as frames.</span></p>                                     </div>
 
</body> 
</html>